
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6.3. æ—§C++çš„å†…å­˜å®‰å…¨é—®é¢˜ - èµ°å‡ºC++è°œäº‘</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script>
      window.MathJax = {"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]],"processEscapes":true,"tags":"ams"},"svg":{"fontCache":"global"}};
    </script>
    
  </head>
  <body>
    <div class="container">
      
        <div class="chapter-container">
          
  <div class="navigation">
    <a href="62--chapter6-2.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š6.2. å†…å­˜å®‰å…¨å¾ˆé‡è¦</a>
    <a href="64-c-chapter6-4.html" class="next-link">ä¸‹ä¸€ç« ï¼š6.4. ç°ä»£C++çš„æ•‘èµ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
          <section id="63-c-chapter6-3" class="section">
            <h2 class="section-title">6.3. æ—§C++çš„å†…å­˜å®‰å…¨é—®é¢˜</h2>
            <p>åœ¨æ·±å…¥æ¢è®¨ä¼ ç»Ÿ C++ ä¸ç°ä»£ C++ çš„å†…å­˜å®‰å…¨é—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ˜ç¡®å…¶å®šä¹‰ã€‚æ´å¼•ç™½å®«æŠ¥å‘Šæ‰€è¿°ï¼šâ€œå†…å­˜å®‰å…¨æ¼æ´æ˜¯æŒ‡ä¸€ç±»ç”±äºå†…å­˜è®¿é—®ã€å†™å…¥ã€åˆ†é…æˆ–é‡Šæ”¾æ“ä½œè¿åé¢„æœŸæ–¹å¼è€Œäº§ç”Ÿçš„æ¼æ´â€¦â€¦ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç©ºé—´å®‰å…¨å’Œæ—¶é—´å®‰å…¨ã€‚ç©ºé—´å®‰å…¨é—®é¢˜æºäºå¯¹å˜é‡å’Œå¯¹è±¡å†…å­˜â€˜æ­£ç¡®â€™è¾¹ç•Œä¹‹å¤–çš„è®¿é—®ï¼›æ—¶é—´å®‰å…¨é—®é¢˜åˆ™å‘ç”Ÿåœ¨å†…å­˜è®¿é—®è¿åæ—¶åºæˆ–çŠ¶æ€æ—¶ï¼Œä¾‹å¦‚è®¿é—®å·²é‡Šæ”¾å¯¹è±¡ï¼Œæˆ–å‡ºç°æ„å¤–äº¤å‰çš„å†…å­˜è®¿é—®ã€‚â€å®Œæ•´å®šä¹‰å‚è§æŠ¥å‘Šç¬¬ 7 é¡µï¼š<a href="https://www.whitehouse.gov/wp-content/uploads/2024/02/Final-ONCD-TechnicalReport.pdf" target="_blank" rel="noopener noreferrer">https://www.whitehouse.gov/wp-content/uploads/2024/02/Final-ONCD-TechnicalReport.pdf</a>ã€‚</p>

<p>æ‰€æœ‰ C++ å¼€å‘è€…éƒ½åº”å¯¹è¿™ä¸¤ç±»é—®é¢˜è€³ç†Ÿèƒ½è¯¦ã€‚ç©ºé—´å®‰å…¨é—®é¢˜åœ¨ä½¿ç”¨åŸç”Ÿæ•°ç»„æ—¶æœ€ä¸ºå¸¸è§ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨èµ‹å€¼åå°è¯•è¶Šç•Œè¯»å†™å…ƒç´ ï¼š</p>

<pre><code class="language-cpp">int doSomeWork(int value1, int value2, int value3, int value4) {
  int array[3];
  array[0] = value1;
  array[1] = value2;
  array[3] = value3;
  array[4] = value4;
  return array[0] + array[1] + array[3] + array[4];
}</code></pre>

<p>è¿™æ®µä»£ç æœ€ä»¤äººæ„å¤–çš„æ˜¯å®ƒå±äºæœªå®šä¹‰è¡Œä¸ºï¼ˆundefined behaviorï¼‰â€”â€” ç¼–è¯‘å™¨å¯èƒ½ä»¥å„ç§æ–¹å¼å¤„ç†æ•°ç»„è¶Šç•Œè®¿é—®ï¼Œä»é™é»˜å…è®¸åˆ°ä¸»åŠ¨æŠ¥é”™éƒ½æœ‰å¯èƒ½ã€‚æ›´å¤æ‚çš„æ˜¯ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿå’Œè¿è¡Œç¯å¢ƒçš„ä¸åŒï¼Œè¯¥ä»£ç ç”šè‡³å¯èƒ½â€œæ­£å¸¸â€è¿è¡Œï¼Œå¹¶è¦†ç›–æœªçŸ¥çš„å†…å­˜åŒºåŸŸã€‚</p>

<div class="tip-box note"><strong>Note</strong>å¯¹æ”»å‡»è€…è€Œè¨€ï¼Œè¿™ç±»ä»£ç ç®€ç›´å°±æ˜¯å®è—ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå°½ç®¡æ¦‚ç‡æä½ï¼Œä½†æŸä¸ªæ—¶åˆ»ï¼Œè¿™ä¸ªè¿›ç¨‹æœ‰å¯èƒ½æ°å¥½ä¸å…³é”®ç³»ç»Ÿè¿›ç¨‹åœ¨å†…å­˜ä¸­ç›¸é‚»å­˜æ”¾ã€‚å¦‚æœæ”»å‡»è€…èƒ½å‘è¯¥å‡½æ•°ä¼ å…¥ç‰¹å®šå€¼ï¼Œå¹¶åœ¨æ°å½“æ—¶æœºè§¦å‘è¶Šç•Œå†™å…¥ï¼Œå°±å¯èƒ½å®ç°ä»¥ä¸‹æ¶æ„è¡Œä¸ºï¼šè¦†ç›–é“¶è¡Œåº”ç”¨ç¨‹åºçš„èº«ä»½éªŒè¯æ£€æŸ¥ä»£ç /å®‰è£…é”®ç›˜è®°å½•å™¨/å‘ç³»ç»Ÿæ¤å…¥æ¶æ„è½¯ä»¶ã€‚è™½ç„¶è¿™ç§æ”»å‡»æ— æ³•ä¿è¯ä¸€å®šæˆåŠŸï¼Œä½†ç”±äºæ•´ä¸ªè¿‡ç¨‹å¯ä»¥è‡ªåŠ¨åŒ–è¿›è¡Œï¼Œæ”»å‡»è€…æ‹¥æœ‰å¤§é‡å°è¯•çš„æœºä¼š â€”â€” åªéœ€è¦æˆåŠŸä¸€æ¬¡å³å¯è¾¾æˆç›®çš„ã€‚</div>

<p>æˆ‘åœ¨ Ubuntu Linux ç³»ç»Ÿä¸Šä½¿ç”¨ clang å’Œ g++ ç¼–è¯‘å™¨æµ‹è¯•äº†è¿™æ®µä»£ç ã€‚g++ å³ä½¿å¯ç”¨äº†æ‰€æœ‰è­¦å‘Šé€‰é¡¹ä¹Ÿæœªç»™å‡ºä»»ä½•æç¤ºï¼Œè€Œ clang åˆ™åœ¨ç¼–è¯‘æ—¶ç»™å‡ºäº†æ•°ç»„è¶Šç•Œçš„è­¦å‘Šã€‚å®é™…è¿è¡Œç¨‹åºæ—¶ï¼Œç³»ç»Ÿæç¤ºï¼šâ€œæ£€æµ‹åˆ°å †æ ˆç ´åï¼šç¨‹åºå·²ç»ˆæ­¢â€ã€‚è¿™è¡¨æ˜è¿è¡Œæ—¶ç¡®å®å­˜åœ¨ä¸€å®šçš„ä¿æŠ¤æœºåˆ¶ï¼Œä½†å¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢æ½œåœ¨å‰¯ä½œç”¨çš„å‘ç”Ÿã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­åˆ›å»ºæ•°ç»„åå°†å…¶ä¼ é€’ç»™å¤šä¸ªå‡½æ•°ï¼Œå¹¶é€šè¿‡å¤æ‚çš„å…¬å¼è®¡ç®—ç´¢å¼•ï¼Œææ€•æ²¡æœ‰ä»»ä½•ç¼–è¯‘å™¨èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å‡ºæ‰€æœ‰çš„è¶Šç•Œè®¿é—®è¡Œä¸ºã€‚æœ€ç»ˆæˆ‘ä»¬åªèƒ½ä¾èµ–è¿è¡Œæ—¶æµ‹è¯•å’Œæ“ä½œç³»ç»Ÿçš„é˜²æŠ¤æœºåˆ¶ã€‚</p>

<p>è¿™æ˜¯ç¼–ç¨‹è¯­è¨€æœ¬èº«çš„ç¼ºé™·å—ï¼Ÿé²œä¸ºäººçŸ¥çš„æ˜¯ï¼Œé‚£äº›è¢«å½’ç±»ä¸ºâ€œå†…å­˜å®‰å…¨â€çš„è¯­è¨€ä¹Ÿå¯èƒ½å†™å‡ºç±»ä¼¼çš„é—®é¢˜ä»£ç ã€‚ä¾‹å¦‚ C# å…è®¸é€šè¿‡ unsafe ä»£ç å—ä½¿ç”¨æŒ‡é’ˆå’ŒæŒ‡é’ˆè¿ç®—ï¼ˆå°½ç®¡æœ‰è¯¸å¤šé™åˆ¶ï¼‰ã€‚ä¸¤è€…çš„å…³é”®åŒºåˆ«åœ¨äºï¼š</p>

<ul>
    <li>éœ€è¦æ˜¾å¼å£°æ˜unsafeä»£ç å—
  
  </li>  <li>å®ç°ç›¸åŒåŠŸèƒ½éœ€è¦æ›´å¤šå·¥ä½œ
  
  </li>  <li>ä¸ä¼šåƒ C++ é‚£æ ·å¸¦æ¥ä¸¥é‡çš„åæœ
  
  </li>  <li>å±é™©ä»£ç å› unsafeæ ‡è®°è€Œæ˜¾çœ¼å¯è§
</ul>

<p>C++ çš„é—®é¢˜å¹¶ä¸åœ¨äºå®ƒå…è®¸è¿™äº›æ“ä½œï¼Œè€Œåœ¨äºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¤ªå®¹æ˜“çŠ¯ä¸‹æ­¤ç±»é”™è¯¯ã€‚æ—¢ç„¶æˆ‘ä»¬å·²ç»è°ˆåˆ°äº†æŒ‡é’ˆï¼Œè¯·çœ‹ä¸‹é¢è¿™æ®µé€šè¿‡ void* æŒ‡é’ˆå’ŒæŒ‡é’ˆè¿ç®—ï¼Œæ¥è¶Šç•Œè®¿é—® int ç±»å‹å†…å­˜çš„ä»£ç ï¼š</p>

</li><pre><code class="language-cpp">int pointerBounds() {
  int *aPointerToInt;
  void *aPointerToVoid;
  aPointerToVoid = new int();
  aPointerToInt = (int*)aPointerToVoid;
  *aPointerToInt = 234;
  aPointerToInt = (int*)((char*)aPointerToVoid + sizeof(int));
  *aPointerToInt = 2423;
  int value = *aPointerToInt;
  delete aPointerToVoid;
  return value;
}
TEST_CASE(&quot;try pointer bounds&quot;){
  int result = pointerBounds();
  CHECK_EQ(2423, result);
}</code></pre>

<p>æˆ‘ä»¬å†æ¬¡é­é‡æœªå®šä¹‰è¡Œä¸ºï¼šé€šè¿‡æŒ‡é’ˆç®—æœ¯è¿ç®—å¾—åˆ°çš„æŒ‡é’ˆèµ‹å€¼æ“ä½œï¼Œå…¶å…·ä½“è¡Œä¸ºç”±ç¼–è¯‘å™¨å†³å®šã€‚è¿™æ¬¡ï¼Œg++ å’Œ clang éƒ½ç»™å‡ºäº†è­¦å‘Š â€”â€” ä½†ä»…é’ˆå¯¹åˆ é™¤ void* æŒ‡é’ˆè¿™ä¸€æ“ä½œã€‚ä¸¤ä¸ªç¼–è¯‘å™¨å¯¹æˆ‘å°è¯•è¯»å†™è¶Šç•Œå†…å­˜åŒºåŸŸçš„è¡Œä¸ºéƒ½æ¯«æ— ååº”ã€‚æ›´æœ‰è¶£çš„æ˜¯ï¼Œæµ‹è¯•è¿è¡Œå®Œå…¨â€œæ­£å¸¸â€ï¼Œå‡½æ•°è¿”å›äº†é¢„æœŸç»“æœï¼Œçš†å¤§æ¬¢å–œï¼ç”šè‡³è¿æ“ä½œç³»ç»Ÿéƒ½æ²¡å¯¹è¿™è’è°¬æ“ä½œæå‡ºæŠ—è®® â€”â€”ä½†æ„¿åªæ˜¯å› ä¸ºæ²¡æœ‰è¶…å‡ºè¿›ç¨‹çš„å†…å­˜åˆ†é…èŒƒå›´ã€‚</p>

<p>ä½†æ„¿å¦‚æ­¤ã€‚</p>

<p>è‡³æ­¤æˆ‘ä»¬çœ‹åˆ°çš„éƒ½æ˜¯ç©ºé—´å†…å­˜å®‰å…¨é—®é¢˜ï¼Œæƒ…å†µå·²ç»ä¸å®¹ä¹è§‚ã€‚é‚£ä¹ˆæ—¶é—´å®‰å…¨é—®é¢˜å‘¢ï¼Ÿä»»ä½•ä½¿ç”¨è¿‡åŸå§‹æŒ‡é’ˆçš„äººéƒ½æ·±æœ‰ä½“ä¼šï¼šå¿…é¡»åœ¨æŒ‡é’ˆä¸å†éœ€è¦æ—¶å®Œæˆä¸¤ä»¶äº‹ â€”â€” é‡Šæ”¾åˆ†é…çš„å†…å­˜ï¼Œå¹¶å°†å…¶ç½®ä¸º nullptrã€‚è¿™ä¸¤è€…éƒ½è‡³å…³é‡è¦ï¼Œå› ä¸ºå¿½ç•¥ä»»ä¸€é¡¹éƒ½ä¼šå¼•å‘æ—¶é—´å®‰å…¨é—®é¢˜ï¼šè¦ä¹ˆäº§ç”Ÿæ‚¬å‚æŒ‡é’ˆ(ä»èƒ½è®¿é—®å·²é‡Šæ”¾å†…å­˜åŒºåŸŸ)ï¼Œè¦ä¹ˆå¯¼è‡´å†…å­˜æ³„æ¼(æŒ‡é’ˆæœªé‡Šæ”¾ä¸”å¯èƒ½å·²è¢«é‡ç½®ï¼Œè‡´ä½¿å†…å­˜åŒºåŸŸæ°¸ä¹…ä¸å¯è®¿é—®)ã€‚</p>

<p>è¯·çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹å‡½æ•°ï¼šå®ƒåˆå§‹åŒ–ä¸€ä¸ª int æŒ‡é’ˆå¹¶èµ‹å€¼ï¼Œé‡Šæ”¾å†…å­˜åï¼Œåˆè¿”å›è¯¥å†…å­˜å­˜å‚¨çš„å€¼ï¼š</p>

<pre><code class="language-cpp">int danglingPointer() {
  int *aPointerToInt = new int(234);
  delete aPointerToInt;
  return *aPointerToInt;
}
TEST_CASE(&quot;Try dangling pointer&quot;){
  int result = danglingPointer();
  CHECK_EQ(234, result);
}</code></pre>

<p>è¿™æ®µä»£ç å†æ¬¡é¡ºåˆ©é€šè¿‡äº†ç¼–è¯‘ â€”â€” æ— è®ºæ˜¯g++è¿˜æ˜¯clangéƒ½æ²¡æœ‰å‘å‡ºä»»ä½•è­¦å‘Šã€‚ç¨‹åºä¹Ÿèƒ½è¿è¡Œï¼Œä½†æµ‹è¯•æœ€ç»ˆå¤±è´¥ï¼šå› ä¸ºæ­¤æ—¶è¯¥å†…å­˜åœ°å€å­˜å‚¨çš„å€¼å·²éé¢„æœŸç»“æœã€‚</p>

<pre><code class="language-shell">test.cpp:8: ERROR: CHECK_EQ( 234, result ) is NOT correct!
  values: CHECK_EQ( 234, 721392248 )</code></pre>

<p>æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¯¥å†…å­˜åœ°å€å­˜å‚¨çš„å€¼éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½äº§ç”Ÿå¦‚ä¸‹ä¸åŒçš„ç»“æœï¼š</p>

<pre><code class="language-shell">test.cpp:8: ERROR: CHECK_EQ( 234, result ) is NOT correct!
  values: CHECK_EQ( 234, 1757279720 )
test.cpp:8: ERROR: CHECK_EQ( 234, result ) is NOT correct!
  values: CHECK_EQ( 234, -1936531037 )</code></pre>

<p>åœ¨åç»­ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œè®¡ç®—å¹¶è¿”å›å¼‚å¸¸ç»“æœï¼Œç®€ç›´å‡ºä¹æ„æ–™åœ°ç®€å•ã€‚å¦‚æœå¯¹ç¨‹åºæ‰§è¡Œçš„è¿ç®—ç¨æœ‰äº†è§£ï¼Œå¹¶èƒ½å¤Ÿåå¤è¾“å…¥ç‰¹å®šçš„å€¼ï¼Œè¿™ç§è¡Œä¸ºç”šè‡³å¯èƒ½è¢«ç”¨ä½œæ¢æŸ¥å†…å­˜å†…å®¹çš„æ‰‹æ®µã€‚</p>

<p>æ—¶é—´å®‰å…¨é—®é¢˜åˆ™æ›´åŠ æ£˜æ‰‹ â€”â€” åœ¨åºå¤§çš„ä»£ç è¿·å®«ä¸­è¿½è¸ªæŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿œæ¯”ç¡®ä¿ä¸è¶Šç•Œè®¿é—®è¦å›°éš¾å¾—å¤šã€‚å¾ˆä¸å¹¸ï¼Œå†…å­˜é—®é¢˜ç¡®å®æ˜¯ C++ ä¸­çš„é‡å¤§éšæ‚£ã€‚</p>

<p>å‰è¿°æ‰€æœ‰ç¤ºä¾‹éƒ½é‡‡ç”¨äº†ä¼ ç»Ÿ C++ çš„ç¼–ç¨‹é£æ ¼ï¼šä½¿ç”¨åŸç”Ÿæ•°ç»„ã€è£¸æŒ‡é’ˆå’ŒæŒ‡é’ˆè¿ç®—ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ç°ä»£ C++ ä¸­åº”å½“æå…¶è°¨æ…åœ°ä½¿ç”¨è¿™äº›ç‰¹æ€§ã€‚è™½ç„¶ä¸èƒ½è¯´åº”è¯¥å®Œå…¨ç¦ç”¨å®ƒä»¬ï¼ˆæ¯•ç«Ÿåœ¨æŸäº›ç‰¹å®šåœºæ™¯ï¼Œå¦‚å†…å­˜ä¼˜åŒ–æˆ–åº•å±‚ç³»ç»Ÿç¼–ç¨‹ä¸­ä»ä¸å¯æˆ–ç¼ºï¼‰ï¼Œä½†é€šå¸¸å¯ä»¥åˆ’å®šæ¸…æ™°çš„è¾¹ç•Œï¼Œå°†è¿™äº›å±é™©æ“ä½œéš”ç¦»åœ¨ç°ä»£ C++ æ‰€å€¡å¯¼çš„å®‰å…¨åŒºåŸŸä¹‹å¤–ã€‚</p>

<p>é‚£ä¹ˆï¼Œç°ä»£ C++ æ˜¯å¦å·²ç»è§£å†³äº†è¿™äº›é—®é¢˜ï¼Ÿ</p>
          </section>
          
  <div class="navigation">
    <a href="62--chapter6-2.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š6.2. å†…å­˜å®‰å…¨å¾ˆé‡è¦</a>
    <a href="64-c-chapter6-4.html" class="next-link">ä¸‹ä¸€ç« ï¼š6.4. ç°ä»£C++çš„æ•‘èµ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
        </div>
        
    </div>
    
    <!-- å…ˆåŠ è½½æ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- åŠ è½½MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
    
    <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      const themeToggle = document.createElement('button');
      themeToggle.className = 'theme-toggle';
      themeToggle.setAttribute('aria-label', 'åˆ‡æ¢ä¸»é¢˜');
      themeToggle.innerHTML = 'ğŸŒ“';
      document.body.appendChild(themeToggle);
      
      // æ·»åŠ æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜çš„æ ·å¼
      const darkThemeStyle = document.createElement('style');
      const lightThemeStyle = document.createElement('style');
      
      darkThemeStyle.textContent = `
        body.dark-theme {
          --background-color: #1a1a1a;
          --text-color: #e6e6e6;
          --code-bg-color: #2d2d2d;
          --link-color: #58a6ff;
          --highlight-color: #58a6ff;
          --border-color: #333;
          --table-border-color: #444;
          --table-header-bg: #2d2d2d;
          --blockquote-color: #aaa;
          --blockquote-border: #444;
          --part-header-bg: #222;
          --footer-text-color: #aaa;
          --filename-bg: #2d2d2d;
          --nav-bg: #2d2d2d;
          --nav-hover-bg: #444;
          --toc-bg: #222;
          --highlight-section-bg: #2d2d2d;
          --highlight-section-border: #58a6ff;
        }
      `;
      
      lightThemeStyle.textContent = `
        body.light-theme {
          --background-color: #ffffff;
          --text-color: #333333;
          --code-bg-color: #f5f5f5;
          --link-color: #0366d6;
          --highlight-color: #0366d6;
          --border-color: #eee;
          --table-border-color: #ddd;
          --table-header-bg: #f2f2f2;
          --blockquote-color: #666;
          --blockquote-border: #ddd;
          --part-header-bg: #f8f8f8;
          --footer-text-color: #666;
          --filename-bg: #f5f5f5;
          --nav-bg: #f5f5f5;
          --nav-hover-bg: #e6e6e6;
          --toc-bg: #f8f8f8;
          --highlight-section-bg: #f8f8f8;
          --highlight-section-border: #0366d6;
        }
      `;
      
      document.head.appendChild(darkThemeStyle);
      document.head.appendChild(lightThemeStyle);
      
      // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è®¾ç½®
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      const currentTheme = localStorage.getItem('theme');
      
      if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (currentTheme === 'light') {
        document.body.classList.add('light-theme');
      } else {
        // å¦‚æœæ²¡æœ‰ä¿å­˜çš„åå¥½ï¼Œè·Ÿéšç³»ç»Ÿ
        if (prefersDarkScheme.matches) {
          document.body.classList.add('dark-theme');
        } else {
          document.body.classList.add('light-theme');
        }
      }
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
      themeToggle.addEventListener('click', function() {
        console.log('Theme toggle clicked');
        if (document.body.classList.contains('dark-theme')) {
          document.body.classList.remove('dark-theme');
          document.body.classList.add('light-theme');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.remove('light-theme');
          document.body.classList.add('dark-theme');
          localStorage.setItem('theme', 'dark');
        }
      });
      
      // ç¡®ä¿ä»£ç å—æœ‰æ­£ç¡®çš„ç±»å
      document.querySelectorAll('pre code').forEach(function(block) {
        if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
          block.className = 'language-cpp';
        } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
          block.className = 'language-rust';
        } else if (!block.className) {
          block.className = 'language-plaintext';
        }
      });
      
      // å»¶è¿ŸåŠ è½½Prismé«˜äº®
      setTimeout(function() {
        if (window.Prism) {
          window.Prism.highlightAll();
        }
      }, 500);
    });
    </script>
  </body>
  </html>
  