
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12.3. Rustçš„ç‰¹æ€§ - èµ°å‡ºC++è°œäº‘</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script>
      window.MathJax = {"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]],"processEscapes":true,"tags":"ams"},"svg":{"fontCache":"global"}};
    </script>
    
  </head>
  <body>
    <div class="container">
      
        <div class="chapter-container">
          
  <div class="navigation">
    <a href="122--chapter12-2.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š12.2. ä¸ºä»€ä¹ˆè¦ç«äº‰ï¼Ÿ</a>
    <a href="124-rust-chapter12-4.html" class="next-link">ä¸‹ä¸€ç« ï¼š12.4. Rustçš„ä¼˜åŠ¿ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
          <section id="123-rust-chapter12-3" class="section">
            <h2 class="section-title">12.3. Rustçš„ç‰¹æ€§</h2>
            <p>è¦ç†è§£Rustçš„æ ¸å¿ƒç‰¹æ€§ï¼Œé¦–æ¨å…¶å®˜ç½‘(<a href="https://www.rust-lang.org/" target="_blank" rel="noopener noreferrer">https://www.rust-lang.org/</a>)ï¼Œè¯¥ç«™å¯¹å…¶æ ¸å¿ƒä¼˜åŠ¿çš„æç‚¼æä¸ºç²¾å½“ï¼š</p>

<ul>
    <li>è¿è¡Œé«˜æ•ˆä¸”å†…å­˜èŠ‚çº¦
  
  </li>  <li>é›¶è¿è¡Œæ—¶å¼€é”€
  
  </li>  <li>æ— åƒåœ¾å›æ”¶æœºåˆ¶
  
  </li>  <li>å“è¶Šçš„è·¨è¯­è¨€äº’æ“ä½œæ€§
  
  </li>  <li>é€šè¿‡ä¸°å¯Œçš„ç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒæ¨¡å‹å®ç°å†…å­˜å®‰å…¨å’Œçº¿ç¨‹å®‰å…¨
  
  </li>  <li>å‡ºè‰²çš„æ–‡æ¡£
  
  </li>  <li>å‹å¥½çš„ç¼–è¯‘ï¨¸ï¼Œæä¾›æœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯
  
  </li>  <li>é›†æˆçš„åŒ…ç®¡ï§¤ï¨¸å’Œæ„å»ºå·¥å…·
  
  </li>  <li>è‡ªåŠ¨æ ¼å¼åŒ–ç¨‹åº
  
  </li>  <li>æ™ºèƒ½å¤šç¼–è¾‘ï¨¸æ”¯æŒï¼Œå…·æœ‰è‡ªåŠ¨å®Œæˆå’Œç±»å‹æ£€æŸ¥
</ul>

<p>ä»…ä»è¿™äº›æè¿°ä¸­ï¼Œæˆ‘ä»¬ä¾¿èƒ½æ¸…æ™°åœ°çœ‹å‡º Rust ä¸ C++ çš„è¯¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä»¥åŠå®ƒåœ¨å¤šä¸ªå…³é”®æ–¹é¢å¯¹ C++ ç°çŠ¶çš„æ˜¾è‘—æ”¹è¿›ã€‚ç›¸ä¼¼ç‚¹ä¸»è¦ä½“ç°åœ¨â€œæ§åˆ¶åŠ›â€å±‚é¢ï¼šåŸç”Ÿç¼–è¯‘ã€æ— åƒåœ¾å›æ”¶ã€é«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ â€”â€” è¿™äº›ç‰¹æ€§ä¹Ÿæ­£æ˜¯ C++ é•¿æœŸä»¥æ¥å¼•ä»¥ä¸ºè±ªçš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p>

<p>è€Œå®ƒä»¬ä¹‹é—´çš„å·®å¼‚ï¼Œåˆ™ç›´æŒ‡æœ¬ä¹¦åå¤æ¢è®¨çš„ç—›ç‚¹æ‰€åœ¨ï¼šæ ‡å‡†åŒ–çš„åŒ…ç®¡ç†ã€ç»Ÿä¸€å·¥å…·é“¾ä»¥åŠå‹å¥½çš„ç¼–è¯‘å™¨ã€‚</p>

<p>å°¤å…¶æ˜¯æœ€åä¸€ç‚¹ï¼Œå¯¹äºé‚£äº›æ›¾é¥±å—å†—é•¿ã€æ™¦æ¶©ã€ä»¤äººæŠ“ç‹‚çš„ C++ ç¼–è¯‘é”™è¯¯ä¿¡æ¯æŠ˜ç£¨çš„å¼€å‘è€…æ¥è¯´ï¼Œç®€ç›´å ªç§°â€œé›ªä¸­é€ç‚­â€ã€‚è¿˜è®°å¾— 2000 å¹´ä»£ä½¿ç”¨ Visual C++ æ—¶çš„å™©æ¢¦å—ï¼Ÿæˆ‘æ›¾äº²èº«ç»å†è¿‡ä¸€æ¬¡ç¼–è¯‘å¤±è´¥ï¼Œæç¤ºå´æ˜¯ï¼šâ€œé”™è¯¯ä¿¡æ¯è¿‡é•¿ï¼Œæ— æ³•æ˜¾ç¤ºâ€ã€‚è™½ç„¶ç°ä»£ C++ åœ¨è¿™æ–¹é¢å·²æœ‰æ˜æ˜¾æ”¹å–„ï¼Œä½†é¢å¯¹æ¨¡æ¿å…ƒç¼–ç¨‹å¼•å‘çš„é”™è¯¯å †æ ˆï¼Œä»ç„¶æ˜¯ä¸€åœºéš¾ä»¥è¨€è¯´çš„å™©æ¢¦ã€‚</p>

<p>ä¸è¿‡ï¼Œè®©æˆ‘ä»¬æš‚ä¸”èµ°å‡ºå®˜ç½‘é¦–é¡µçš„å®£ä¼ è¯­ï¼Œæ·±å…¥æŒ–æ˜ä¸€äº›çœŸæ­£è®©äººçœ¼å‰ä¸€äº®çš„åŠŸèƒ½ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»å‡ ä¸ªç›¸è¾ƒäº C++ è€Œè¨€ç‰¹åˆ«å®ç”¨ä¸”æœ‰è¶£çš„ Rust ç‰¹æ€§ï¼š</p>

<h4>12.3.1 é¡¹ç›®æ¨¡æ¿ç³»ç»Ÿå’ŒåŒ…ç®¡ç†æœºåˆ¶</h4>

<p>ä½œä¸ºå‘½ä»¤è¡Œå’ŒNeovimä»£ç ç¼–è¾‘å™¨çš„é‡åº¦ç”¨æˆ·ï¼Œæˆ‘å°¤å…¶é’Ÿçˆ±èƒ½ç›´æ¥ä»å‘½ä»¤è¡Œåˆ›å»ºé¡¹ç›®çš„æŠ€æœ¯ã€‚Rustè‡ªå¸¦çš„cargoå·¥å…·å¯ä»¥å®Œæˆé¡¹ç›®åˆ›å»ºã€æ„å»ºã€è¿è¡Œã€æ‰“åŒ…å’Œå‘å¸ƒå…¨æµç¨‹å·¥ä½œï¼š</p>

<ul>
  </li>  <li>åˆ›å»ºé¡¹ç›®ï¼šcargo new é¡¹ç›®å
  
  </li>  <li>è¿è¡Œé¡¹ç›®ï¼šcargo run
  
  </li>  <li>æ£€æŸ¥ç¼–è¯‘é”™è¯¯ï¼šcargo check
  
  </li>  <li>ç¼–è¯‘é¡¹ç›®ï¼šcargo build
  
  </li>  <li>æ‰“åŒ…é¡¹ç›®ï¼šå¦‚æ‚¨æ‰€æ–™ â€”â€” cargo package
  
  </li>  <li>å‘å¸ƒé¡¹ç›®ï¼š(é¼“ç‚¹å£°)...cargo publish
</ul>

<p>é€šè¿‡ cargoï¼Œæˆ‘ä»¬ä¸ä»…èƒ½è½»æ¾åˆ›å»ºåº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜èƒ½åˆ©ç”¨ cargo generate å·¥å…·(å‚è§<a href="https://cargo-generate.github.io/cargo-generate/" target="_blank" rel="noopener noreferrer">https://cargo-generate.github.io/cargo-generate/</a>)åŸºäºé¢„å®šä¹‰çš„é¡¹ç›®æ¨¡æ¿å¿«é€Ÿåˆå§‹åŒ–æ–°é¡¹ç›®ã€‚</p>

<p>æˆ‘çŸ¥é“ï¼Œè¿™å¯¹å¤§å¤šæ•° C++ å¼€å‘è€…æ¥è¯´å¯èƒ½å¹¶ä¸ç¨€å¥‡ â€”â€” æ¯•ç«Ÿä½ ä»¬å¾ˆå°‘ä»å¤´å¼€å§‹åˆ›å»ºæ–°é¡¹ç›®ã€‚åœ¨æ•™æˆ C++ å¼€å‘è€…è¿›è¡Œå•å…ƒæµ‹è¯•æˆ–å®è·µæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰æ—¶ï¼Œè¿™ä¸€ç‚¹å¸¸å¸¸è®©æˆ‘æ„Ÿåˆ°æƒŠè®¶ï¼šæˆ‘ä»¬ä¸å¾—ä¸ä¸€èµ·è´¹åŠ²åœ°æ‰‹åŠ¨é…ç½®æµ‹è¯•é¡¹ç›®ä¸ç”Ÿäº§ä»£ç ä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œè€Œè¿™äº›æœ¬åº”æ˜¯ç†æ‰€å½“ç„¶ã€ä¸€é”®å³å¯å®Œæˆçš„æ“ä½œã€‚</p>

<p>è¯·ç›¸ä¿¡æˆ‘ï¼Œè¿™ç§ä¾¿æ·æ€§ä¸ä»…ä½“ç°åœ¨é¡¹ç›®åˆæœŸï¼Œåœ¨è¿›è¡Œå°å‹å®éªŒã€ä¸ªäººç»ƒä¹ ã€ç”šè‡³ä¼˜åŒ–ç¼–è¯‘æ—¶é—´æ–¹é¢éƒ½å¤§æœ‰è£¨ç›Šã€‚</p>

<p>åœ¨ SSD ç¡¬ç›˜å°šæœªæ™®åŠã€ç¼–è¯‘é€Ÿåº¦ä»ä»¤äººå¤´ç–¼çš„å¹´ä»£ï¼Œæˆ‘æ›¾å¸¸ç”¨ä¸€ä¸ªâ€œåœŸåŠæ³•â€æ¥åº”å¯¹ C++ ç¼–è¯‘ç¼“æ…¢çš„é—®é¢˜ï¼šå°†æ­£åœ¨ä¿®æ”¹çš„å°‘æ•°å‡ ä¸ªæ–‡ä»¶å•ç‹¬ç»„æˆä¸€ä¸ªæ–°çš„ç¼–è¯‘å•å…ƒï¼Œå…¶ä½™éƒ¨åˆ†åˆ™ä½œä¸ºäºŒè¿›åˆ¶ä¾èµ–å¼•ç”¨è¿›æ¥ â€”â€” è¿™è™½ç„¶åŸå§‹ï¼Œä½†ç¡®å®èƒ½æ˜¾è‘—ç¼©çŸ­æ¯æ¬¡æ„å»ºçš„æ—¶é—´ã€‚</p>

<p>å…³äºæ–°å»ºé¡¹ç›®çš„è®¨è®ºå°±åˆ°è¿™é‡Œã€‚</p>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†™ç‚¹ä»£ç â€¦â€¦æˆ–è€…è¯´ï¼Œå°è¯•ä¿®æ”¹ä¸€äº›å˜é‡â€¦â€¦</p>

<p>ï¼ˆçªç„¶æƒ³èµ· Rust çš„é»˜è®¤ä¸å¯å˜æ€§ï¼‰</p>

<h4>12.3.2 ä¸å¯å˜æ€§</h4>

<p>Rust é»˜è®¤é‡‡ç”¨ä¸å¯å˜è®¾è®¡ï¼Œæ­£å¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š"å€¼ä¸€æ—¦è¢«ç»‘å®šåˆ°å˜é‡åï¼Œå°±æ— æ³•æ›´æ”¹è¯¥å€¼"ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¼”ç¤ºï¼šå…ˆä¸ºå˜é‡åˆ†é…å­—ç¬¦ä¸²å€¼å¹¶æ˜¾ç¤ºï¼Œç„¶åå°è¯•ä¿®æ”¹å®ƒï¼š</p>

</li><pre><code class="language-rust">fn main() {
  let the_message = &quot;Hello, world!&quot;;
  println!(&quot;{the_message}&quot;);
  the_message = &quot;A new hello!&quot;;
  println!(&quot;{the_message}&quot;);
}</code></pre>

<p>å°è¯•ç¼–è¯‘æ­¤ç¨‹åºä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>

<code>cannot assign twice to immutable variable the_message</code>

<p>è´´å¿ƒçš„é”™è¯¯ä¿¡æ¯è¿˜åŒ…å«æç¤ºï¼š</p>

<code>For more information about this error, try 'rustc --explain E0384'</code>

<p>é”™è¯¯è§£é‡Šä¸ä»…åŒ…å«ç¤ºä¾‹ï¼Œè¿˜æ˜ç¡®è¯´æ˜å¦‚ä½•å£°æ˜å¯å˜å˜é‡ï¼š</p>

<p><em>"Rustå˜é‡é»˜è®¤ä¸å¯å˜ã€‚è¦ä¿®å¤æ­¤é”™è¯¯ï¼Œéœ€åœ¨å£°æ˜å˜é‡æ—¶äºletåæ·»åŠ mutå…³é”®å­—"ã€‚</em></p>

<p>ä»¥ä¸‹æ˜¯ä¿®æ”¹åå¯æ­£å¸¸ç¼–è¯‘çš„ä»£ç ç¤ºä¾‹ï¼š</p>

<pre><code class="language-rust">let mut the_message = &quot;Hello, world!&quot;;
println!(&quot;{the_message}&quot;);
the_message = &quot;A new hello!&quot;;
println!(&quot;{the_message}&quot;);</code></pre>

<p>ç”±æ­¤å¯è§ï¼Œå¯å˜å˜é‡å¿…é¡»æ˜¾å¼å£°æ˜ä¸º mutï¼Œè¿™ä½“ç°äº†Rusté»˜è®¤ä¸å¯å˜çš„è®¾è®¡å“²å­¦ã€‚</p>

<p>æ­£å¦‚å‰å‡ ç« è®¨è®ºçš„ï¼Œè¿™ç§è®¾è®¡èƒ½æœ‰æ•ˆè§£å†³å¹¶è¡Œå¹¶å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•å’Œä»£ç ç®€æ´æ€§ç­‰è¯¸å¤šé—®é¢˜ã€‚</p>

<h4>12.3.3 å¤åˆç±»å‹çš„ç®€æ´è¯­æ³•</h4>

<p>Rust å€Ÿé‰´äº† Python å’Œ Ruby ç­‰è¯­è¨€çš„è¯­æ³•ç‰¹æ€§æ¥å¤„ç†æ•°ç»„å’Œå…ƒç»„ï¼Œå…¶å£°æ˜æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-rust">let months = [&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;];
println!(&quot;{:?}&quot;, months);
let (one, two) = (1, 1+1);
println!(&quot;{one} and {two}&quot;);</code></pre>

<p>è¿™çœ‹ä¼¼å¾®ä¸è¶³é“,å´èƒ½æ˜¾è‘—ç®€åŒ–ä»£ç ã€‚å€¼å¾—ä¸€æçš„æ˜¯,C++è‡ªC++11èµ·é€šè¿‡èŠ±æ‹¬å·åˆ—è¡¨åˆå§‹åŒ–(list initializer)å¼•å…¥äº†ç±»ä¼¼è¯­æ³•,å¹¶åœ¨åç»­ç‰ˆæœ¬ä¸­æŒç»­ä¼˜åŒ–:</p>

<pre><code class="language-rust">std::vector&lt;string&gt; months = {&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;};</code></pre>

<p>æˆ‘æœŸå¾…è¿™æ–¹é¢èƒ½æœ‰æ›´å¤šæ”¹è¿›ï¼Œä½†è€ƒè™‘åˆ°C++è¯­æ³•å·²ç„¶ååˆ†å¤æ‚ï¼Œå¯¹æ­¤å¹¶ä¸æŠ±å¤ªé«˜æœŸæœ›ã€‚</p>

<h4>12.3.4 å¯çœç•¥çš„returnå…³é”®å­—</h4>

<p>Rustå‡½æ•°å…è®¸ç›´æ¥è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚</p>

<p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¯¥ç‰¹æ€§å®ç°æ•°å­—è‡ªå¢ï¼š</p>

<pre><code class="language-rust">fn main() {
  let two = increment(1);
  println!(&quot;{two}&quot;);
}
fn increment(x:i32) -&gt; i32{
  x+1
}</code></pre>

<p>è™½ç„¶åœ¨å‰è¿°ç®€å•å‡½æ•°ä¸­æˆ‘é€šå¸¸ä¸ä¼šä½¿ç”¨è¿™ç§å†™æ³•ï¼Œä½†çœç•¥returnå…³é”®å­—ç¡®å®èƒ½ç®€åŒ–é—­åŒ…ç¼–å†™ â€”â€” è¿™æ­£æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ¢è®¨çš„å†…å®¹ã€‚</p>

<h4>12.3.5 é—­åŒ…</h4>

<p>è®©æˆ‘ä»¬å¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œè‡ªå¢æ“ä½œï¼š</p>

<pre><code class="language-rust">fn increment_all() -&gt; Vec&lt;i32&gt;{
  let values : Vec&lt;i32&gt; = vec![1, 2, 3];
  return values.iter().map(|x| x+1).collect();
}</code></pre>

<p>ä¸å‡½æ•°å¼ç¼–ç¨‹çš„å¸¸è§„åšæ³•ç±»ä¼¼(å¦‚åŒC++ä¸­çš„rangesåº“)ï¼š</p>

<ul>
    <li>è·å–è¿­ä»£å™¨
  
  </li>  <li>è°ƒç”¨mapå‡½æ•°(ç›¸å½“äºC++ä¸­çš„transformç®—æ³•)å¹¶ä¼ å…¥é—­åŒ…
  
  </li>  <li>è°ƒç”¨collectè·å–ç»“æœé›†
</ul>

<p>é—­åŒ…è¯­æ³•ä¹‹æ‰€ä»¥å¦‚æ­¤ç®€æ´ï¼Œæ­£æ˜¯å¾—ç›Šäºå¯é€‰çš„returnè¯­å¥è®¾è®¡ã€‚</p>

<h4>12.3.6 æ ‡å‡†åº“ä¸­çš„å•å…ƒæµ‹è¯•</h4>

<p>å•å…ƒæµ‹è¯•æ˜¯è½¯ä»¶å¼€å‘ä¸­è‡³å…³é‡è¦çš„å®è·µï¼Œä½†ä»…æœ‰å°‘æ•°è¯­è¨€åœ¨æ ‡å‡†åº“ä¸­æä¾›åŸç”Ÿæ”¯æŒã€‚Rusté»˜è®¤é›†æˆäº†è¿™ä¸€åŠŸèƒ½ï¼Œä¸”ä½¿ç”¨æå…¶ç®€ä¾¿ã€‚è®©æˆ‘ä»¬ä¸ºincrement&#95;allå‡½æ•°æ·»åŠ å•å…ƒæµ‹è¯•ä»¥éªŒè¯å…¶è¡Œä¸ºç¬¦åˆé¢„æœŸï¼š</p>

</li><pre><code class="language-rust">#[cfg(test)]
mod tests {
  use super::*;
  #[test]
  fn it_works() {
    assert_eq!(vec![2, 3, 4], increment_all());
  }
}</code></pre>

<p>æˆ‘ç‰¹åˆ«æ¬£èµRustå…è®¸åœ¨åŒä¸€ä¸ªç¼–è¯‘å•å…ƒ(Rustä¸­ç§°ä¸ºcrate)å†…åŒæ—¶ç¼–å†™ç”Ÿäº§ä»£ç å’Œå•å…ƒæµ‹è¯•çš„ä¾¿æ·æ€§ã€‚å¦‚æœä»…å°†å•å…ƒæµ‹è¯•è§†ä¸ºä¹‰åŠ¡æ€§å·¥ä½œï¼Œè¿™å¯èƒ½æ— è¶³è½»é‡ï¼›ä½†å¯¹æˆ‘è¿™æ ·å¸¸é€šè¿‡å•å…ƒæµ‹è¯•è¿›è¡ŒæŠ€æœ¯æ¢ç´¢å’Œè®¾è®¡éªŒè¯çš„å¼€å‘è€…è€Œè¨€ï¼Œæ­¤ç‰¹æ€§å®å±ç¦éŸ³ã€‚</p>

<h4>12.3.7 ç‰¹è´¨</h4>

<p>Rust(ä»¥åŠGo)ä¸å…¶ä»–ä¸»æµè¯­è¨€çš„ä¸€å¤§åŒºåˆ«åœ¨äºï¼šå®ƒä¸æ”¯æŒç»§æ‰¿æœºåˆ¶ï¼Œè€Œæ˜¯æ¨å´‡ç»„åˆæ¨¡å¼ã€‚ä¸ºå®ç°å¤šæ€è¡Œä¸ºï¼ŒRustæä¾›äº†ç‰¹è´¨(trait)è¿™ä¸€ç‰¹æ€§ã€‚</p>

<p>Rustçš„ç‰¹è´¨ç±»ä¼¼äºé¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„æ¥å£ï¼Œå®ƒä»¬å®šä¹‰äº†ä¸€ç»„éœ€è¦ç”±æ´¾ç”Ÿç±»å‹å®ç°çš„æ–¹æ³•ã€‚ä½†Rustç‰¹è´¨æœ‰ä¸ªç‹¬ç‰¹åŠŸèƒ½ï¼šå¯ä»¥ä¸ºéè‡ªèº«å®šä¹‰çš„ç±»å‹æ·»åŠ ç‰¹è´¨ã€‚è¿™ä¸C#çš„æ‰©å±•æ–¹æ³•ç±»ä¼¼ï¼Œä½†åˆä¸å°½ç›¸åŒã€‚</p>

<p>Rustå®˜æ–¹æ–‡æ¡£é€šè¿‡ä¸¤ä¸ªç»“æ„ä½“ç¤ºä¾‹æ¼”ç¤ºäº†ç‰¹è´¨çš„ä½¿ç”¨ï¼šä¸€ä¸ªè¡¨ç¤ºæ¨æ–‡(tweet)ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºæ–°é—»æ–‡ç« (news article)ã€‚ä¸ºä¸¤è€…æ·»åŠ Summaryç‰¹è´¨åï¼Œå°±èƒ½ç”Ÿæˆå¯¹åº”çš„å†…å®¹æ‘˜è¦ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œç‰¹è´¨å®ç°æ—¢ç‹¬ç«‹äºç»“æ„ä½“å®ç°ï¼Œä¹Ÿç‹¬ç«‹äºç‰¹è´¨å®šä¹‰æœ¬èº«ï¼Œè¿™ç§è®¾è®¡æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚</p>

<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªç»“æ„ä½“çš„å®šä¹‰ã€‚æ–°é—»æ–‡ç« ç»“æ„ä½“NewsArticleåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>

<pre><code class="language-rust">pub struct NewsArticle {
  pub headline: String,
  pub location: String,
  pub author: String,
  pub content: String,
}</code></pre>

<p>ç„¶åï¼ŒTweet ç»“æ„åŒ…å«å…¶è‡ªå·±çš„å­—æ®µï¼š</p>

<pre><code class="language-rust">pub struct Tweet {
  pub username: String,
  pub content: String,
  pub reply: bool,
  pub retweet: bool,
}</code></pre>

<p>å¦å¤–ï¼Œä½¿ç”¨è¿”å›å­—ç¬¦ï¤…çš„å•ä¸ªæ–¹æ³• summarize æ¥å®šä¹‰ Summary traitï¼š</p>

<pre><code class="language-rust">pub trait Summary {
  fn summarize(&amp;self) -&gt; String;
}</code></pre>

<p>ç°åœ¨,ä¸º Tweet ç»“æ„å®æ–½ Summary ç‰¹å¾ã€‚é€šè¿‡æŒ‡å®šæ­¤ trait çš„å®ç°åº”ç”¨äºç»“æ„æ¥å®Œæˆ:</p>

<pre><code class="language-rust">impl Summary for Tweet {
  fn summarize(&amp;self) -&gt; String {
    format!(&quot;{}: {}&quot;, self.username, self.content)
  }
}</code></pre>

<p>æµ‹è¯•å®Œç¾è¿ï¨ˆï¼š</p>

<pre><code class="language-rust">#[test]
fn summarize_tweet() {
  let tweet = Tweet {
    username: String::from(&quot;me&quot;),
    content: String::from(&quot;a message&quot;),
    reply: false,
    retweet: false,
  };
  assert_eq!(&quot;me: a message&quot;, tweet.summarize());
}</code></pre>

<p>æœ€åï¼Œè®©å®ç°NewsArticleçš„ç‰¹å¾ï¼š</p>

<pre><code class="language-rust">impl Summary for NewsArticle {
  fn summarize(&amp;self) -&gt; String {
    format!(&quot;{}, by {} ({})&quot;, self.headline, self.author, self.location)
  }
}
#[test]
  fn summarize_news_article() {
    let news_article = NewsArticle {
      headline: String::from(&quot;Big News&quot;),
      location: String::from(&quot;Undisclosed&quot;),
      author: String::from(&quot;Me&quot;),
      content: String::from(&quot;Big News here, must follow&quot;),
    };
    assert_eq!(&quot;Big News, by Me (Undisclosed)&quot;, news_article.summarize());
  }</code></pre>

<p>Rustçš„ç‰¹è´¨ç³»ç»Ÿè¿œä¸æ­¢äºæ­¤ï¼Œå®ƒå…·å¤‡æ›´å¼ºå¤§çš„èƒ½åŠ›ï¼š</p>

<ul>
    <li>å¯æä¾›é»˜è®¤æ–¹æ³•å®ç°
  
  </li>  <li>å¯é™å®šå‚æ•°ç±»å‹éœ€å®ç°ç‰¹å®šç‰¹è´¨(æˆ–ç‰¹è´¨ç»„åˆ)
  
  </li>  <li>å¯æ³›åŒ–åœ°ä¸ºå¤šç§ç±»å‹å®ç°ç‰¹è´¨
  
  </li>  <li>èåˆäº†é¢å‘å¯¹è±¡æ¥å£ã€C#æ‰©å±•æ–¹æ³•å’ŒC++æ¦‚å¿µçš„å¤šé‡ç‰¹æ€§
</ul>

<p>è™½ç„¶è¿™äº›é«˜çº§ç”¨æ³•å·²è¶…å‡ºæœ¬ç« è®¨è®ºèŒƒå›´ã€‚</p>

<p>æœ€å€¼å¾—é“­è®°çš„æ˜¯ï¼šRustå¤„ç†ç»§æ‰¿çš„æ–¹å¼ä¸C++æœ‰ç€æ ¹æœ¬æ€§å·®å¼‚ã€‚</p>

<h4>12.3.8 æ‰€æœ‰æƒæ¨¡å‹</h4>

<p>Rustæœ‰ä¸ªæå…·ç‰¹è‰²çš„è®¾è®¡ï¼Œä¹Ÿæ˜¯å…¶æœ€å¹¿ä¸ºäººçŸ¥çš„ç‰¹æ€§ â€”â€” æ‰€æœ‰æƒæ¨¡å‹ã€‚è¿™æ˜¯Rusté’ˆå¯¹C++å†…å­˜å®‰å…¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä¸åŒäºJava/C#é‡‡ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒRusté€šè¿‡æ›´æ˜ç¡®çš„å†…å­˜æ‰€æœ‰æƒæ¥è§£å†³é—®é¢˜ã€‚</p>

<p>å¦‚ã€ŠRustç¼–ç¨‹è¯­è¨€ã€‹æ‰€è¿°(<a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html</a>)ï¼šâ€œå†…å­˜é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥ä¸€ç»„è§„åˆ™ã€‚ä»»ä½•è§„åˆ™è¢«è¿åæ—¶ï¼Œç¨‹åºéƒ½æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚æ‰€æœ‰æƒçš„æ‰€æœ‰ç‰¹æ€§éƒ½ä¸ä¼šåœ¨è¿è¡Œæ—¶æ‹–æ…¢ç¨‹åºé€Ÿåº¦ã€‚â€</p>

<p>Rustæ‰€æœ‰æƒçš„ä¸‰å¤§æ ¸å¿ƒè§„åˆ™ï¼š</p>

<ul>
  </li>  <li>Rustä¸­çš„æ¯ä¸ªå€¼éƒ½æœ‰å”¯ä¸€æ‰€æœ‰è€…
  
  </li>  <li>åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
  
  </li>  <li>å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼å°†è‡ªåŠ¨é‡Šæ”¾
</ul>

<p>å…ˆçœ‹ä¸€ä¸ªä¸C++è¡Œä¸ºç›¸åŒçš„ä¾‹å­ã€‚å¯¹äºæ ˆä¸Šåˆ†é…çš„å˜é‡(å¦‚æ•´å‹)ï¼Œå…¶å¤åˆ¶è¡Œä¸ºç¬¦åˆå¸¸è§„è®¤çŸ¥ï¼š</p>

</li><pre><code class="language-rust">#[test]
fn copy_on_stack() {
  let stack_value = 1;
  let copied_stack_value = stack_value;
  assert_eq!(1, stack_value);
  assert_eq!(1, copied_stack_value);
}</code></pre>

<p>æ­£å¦‚é¢„æœŸçš„é‚£æ ·,è¿™ä¸¤ä¸ªå˜é‡å…·æœ‰ç›¸åŒçš„å€¼ã€‚ä½†å¦‚æœå°è¯•ä½¿ç”¨åœ¨å †ä¸Šåˆ†é…çš„å˜é‡å†™ç›¸åŒçš„ä»£ç ,åˆ™ä¼šæ”¶åˆ°é”™è¯¯:</p>

<pre><code class="language-rust">#[test]
fn copy_on_heap() {
  let heap_value = String::from(&quot;A string&quot;);
  let copied_heap_value = heap_value;
  assert_eq!(String::from(&quot;A string&quot;), heap_value);
  assert_eq!(String::from(&quot;A string&quot;), copied_heap_value);
}</code></pre>

<p>è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä¼šé‡åˆ°é”™è¯¯:</p>

<code>[E0382]: borrow of moved value: 'heap_value'</code>

<p>ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå°†heap&#95;valueèµ‹å€¼ç»™copied&#95;heap&#95;valueæ—¶ï¼ŒåŸå˜é‡heap&#95;valueéšå³å¤±æ•ˆ â€”â€” è¿™ä¸C++çš„ç§»åŠ¨è¯­ä¹‰å¦‚å‡ºä¸€è¾™ï¼Œåªæ˜¯æ— éœ€å¼€å‘è€…è¿›è¡Œæ“ä½œã€‚å…¶åº•å±‚æœºåˆ¶é€šè¿‡ä¸¤ä¸ªç‰¹è´¨å®ç°ï¼šCopyå’ŒDropã€‚è‹¥ç±»å‹å®ç°Copyç‰¹è´¨ï¼Œåˆ™è¡¨ç°å¦‚ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼›è‹¥å®ç°Dropç‰¹è´¨ï¼Œåˆ™è¡¨ç°å¦‚ç¬¬äºŒä¸ªç¤ºä¾‹ã€‚æ³¨æ„ï¼šä»»ä½•ç±»å‹éƒ½ä¸èƒ½åŒæ—¶å®ç°è¿™ä¸¤ä¸ªç‰¹è´¨ã€‚</p>

<p>è¦è®©ä¸Šè¿°ç¤ºä¾‹æ­£å¸¸å·¥ä½œï¼Œéœ€è¦æ”¹ç”¨å…‹éš†æœºåˆ¶è€Œéé»˜è®¤çš„ç§»åŠ¨è¯­ä¹‰ï¼š</p>

<pre><code class="language-rust">#[test]
fn clone_on_heap() {
  let heap_value = String::from(&quot;A string&quot;);
  let copied_heap_value = heap_value.clone();
  assert_eq!(String::from(&quot;A string&quot;), heap_value);
  assert_eq!(String::from(&quot;A string&quot;), copied_heap_value);
}</code></pre>

<p>è¿™ä¸ªç¤ºä¾‹å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæ­¤æ—¶æ‰§è¡Œçš„æ˜¯å€¼å…‹éš†(è€Œéå¼•ç”¨åŒä¸€å†…å­˜åœ°å€)ï¼Œæ‰€ä»¥åœ¨å †ä¸Šè¿›è¡Œäº†æ–°çš„å†…å­˜åˆ†é…ã€‚</p>

<p>ç§»åŠ¨è¯­ä¹‰åœ¨å‡½æ•°è°ƒç”¨ä¸­åŒæ ·é€‚ç”¨ã€‚æ¥åˆå§‹åŒ–ä¸€ä¸ªå€¼å¹¶å°†å…¶ä¼ é€’ç»™å‡½æ•°(è¯¥å‡½æ•°åŸæ ·è¿”å›æ­¤å€¼)ï¼Œè§‚å¯Ÿä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>

<pre><code class="language-rust">fn call_me(value: String) -&gt; String {
  return value;
}
#[test]
fn move_semantics_method_call() {
  let heap_value = String::from(&quot;A string&quot;);
  let result = call_me(heap_value);
  assert_eq!(String::from(&quot;A string&quot;), heap_value);
  assert_eq!(String::from(&quot;A string&quot;), result);
}</code></pre>

<p>åœ¨ç¼–è¯‘è¿™æ®µä»£ç æ—¶ï¼Œä¼šé‡åˆ°ä¸ä¹‹å‰ç›¸åŒçš„é”™è¯¯ï¼š</p>

<code>error[E0382]: borrow of moved value: 'heap_value'</code>

<p>è¿™æ˜¯å› ä¸ºå †ä¸Šåˆ›å»ºçš„å€¼ç§»åŠ¨åˆ°call&#95;meå‡½æ•°ä¸­ï¼Œå¯¼è‡´å…¶è„±ç¦»äº†å½“å‰ä½œç”¨åŸŸè€Œé‡Šæ”¾ã€‚</p>

<p>è¦ä½¿ä»£ç æ­£å¸¸å·¥ä½œï¼Œéœ€è¦æŒ‡å®šå‡½æ•°åº”è¯¥å€Ÿç”¨(borrow)æ‰€æœ‰æƒè€Œéå–å¾—æ‰€æœ‰æƒ â€”â€” è¿™é€šè¿‡å¼•ç”¨å’Œè§£å¼•ç”¨æ“ä½œç¬¦å®ç°(ä¸C++çš„è¯­æ³•ç›¸åŒ)ï¼š</p>

<pre><code class="language-rust">fn i_borrow(value: &amp;String) -&gt; &amp;String {
  return value;
}
#[test]
fn borrow_method_call() {
  let heap_value = String::from(&quot;A string&quot;);
  let result = i_borrow(&amp;heap_value);
  assert_eq!(String::from(&quot;A string&quot;), heap_value);
  assert_eq!(String::from(&quot;A string&quot;), *result);
}</code></pre>

<p>Rustå¼•ç”¨ä¸C++å¼•ç”¨çš„å…³é”®åŒºåˆ«åœ¨äºï¼šRustå¼•ç”¨é»˜è®¤æ˜¯ä¸å¯å˜çš„(immutable)ã€‚</p>

<p>å½“ç„¶ï¼ŒRustçš„æ‰€æœ‰æƒæ¨¡å‹è¿˜æœ‰æ›´å¤šç²¾å¦™ä¹‹å¤„éœ€è¦æ¢ç´¢ï¼Œä½†ç›¸ä¿¡è¿™äº›ç¤ºä¾‹å·²è¶³å¤Ÿåˆæ­¥ç†è§£å…¶è¿ä½œæœºåˆ¶ï¼Œä»¥åŠå¦‚ä½•æœ‰æ•ˆé¢„é˜²å†…å­˜å®‰å…¨é—®é¢˜ã€‚</p>
          </section>
          
  <div class="navigation">
    <a href="122--chapter12-2.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š12.2. ä¸ºä»€ä¹ˆè¦ç«äº‰ï¼Ÿ</a>
    <a href="124-rust-chapter12-4.html" class="next-link">ä¸‹ä¸€ç« ï¼š12.4. Rustçš„ä¼˜åŠ¿ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
        </div>
        
    </div>
    
    <!-- å…ˆåŠ è½½æ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- åŠ è½½MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
    
    <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      const themeToggle = document.createElement('button');
      themeToggle.className = 'theme-toggle';
      themeToggle.setAttribute('aria-label', 'åˆ‡æ¢ä¸»é¢˜');
      themeToggle.innerHTML = 'ğŸŒ“';
      document.body.appendChild(themeToggle);
      
      // æ·»åŠ æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜çš„æ ·å¼
      const darkThemeStyle = document.createElement('style');
      const lightThemeStyle = document.createElement('style');
      
      darkThemeStyle.textContent = `
        body.dark-theme {
          --background-color: #1a1a1a;
          --text-color: #e6e6e6;
          --code-bg-color: #2d2d2d;
          --link-color: #58a6ff;
          --highlight-color: #58a6ff;
          --border-color: #333;
          --table-border-color: #444;
          --table-header-bg: #2d2d2d;
          --blockquote-color: #aaa;
          --blockquote-border: #444;
          --part-header-bg: #222;
          --footer-text-color: #aaa;
          --filename-bg: #2d2d2d;
          --nav-bg: #2d2d2d;
          --nav-hover-bg: #444;
          --toc-bg: #222;
          --highlight-section-bg: #2d2d2d;
          --highlight-section-border: #58a6ff;
        }
      `;
      
      lightThemeStyle.textContent = `
        body.light-theme {
          --background-color: #ffffff;
          --text-color: #333333;
          --code-bg-color: #f5f5f5;
          --link-color: #0366d6;
          --highlight-color: #0366d6;
          --border-color: #eee;
          --table-border-color: #ddd;
          --table-header-bg: #f2f2f2;
          --blockquote-color: #666;
          --blockquote-border: #ddd;
          --part-header-bg: #f8f8f8;
          --footer-text-color: #666;
          --filename-bg: #f5f5f5;
          --nav-bg: #f5f5f5;
          --nav-hover-bg: #e6e6e6;
          --toc-bg: #f8f8f8;
          --highlight-section-bg: #f8f8f8;
          --highlight-section-border: #0366d6;
        }
      `;
      
      document.head.appendChild(darkThemeStyle);
      document.head.appendChild(lightThemeStyle);
      
      // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è®¾ç½®
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      const currentTheme = localStorage.getItem('theme');
      
      if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (currentTheme === 'light') {
        document.body.classList.add('light-theme');
      } else {
        // å¦‚æœæ²¡æœ‰ä¿å­˜çš„åå¥½ï¼Œè·Ÿéšç³»ç»Ÿ
        if (prefersDarkScheme.matches) {
          document.body.classList.add('dark-theme');
        } else {
          document.body.classList.add('light-theme');
        }
      }
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
      themeToggle.addEventListener('click', function() {
        console.log('Theme toggle clicked');
        if (document.body.classList.contains('dark-theme')) {
          document.body.classList.remove('dark-theme');
          document.body.classList.add('light-theme');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.remove('light-theme');
          document.body.classList.add('dark-theme');
          localStorage.setItem('theme', 'dark');
        }
      });
      
      // ç¡®ä¿ä»£ç å—æœ‰æ­£ç¡®çš„ç±»å
      document.querySelectorAll('pre code').forEach(function(block) {
        if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
          block.className = 'language-cpp';
        } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
          block.className = 'language-rust';
        } else if (!block.className) {
          block.className = 'language-plaintext';
        }
      });
      
      // å»¶è¿ŸåŠ è½½Prismé«˜äº®
      setTimeout(function() {
        if (window.Prism) {
          window.Prism.highlightAll();
        }
      }, 500);
    });
    </script>
  </body>
  </html>
  