
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5.4. é»‘æš—æ³•åˆ™ - èµ°å‡ºC++è°œäº‘</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script>
      window.MathJax = {"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]],"processEscapes":true,"tags":"ams"},"svg":{"fontCache":"global"}};
    </script>
    
  </head>
  <body>
    <div class="container">
      
        <div class="chapter-container">
          
  <div class="navigation">
    <a href="53--chapter5-3.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š5.3. æ€è€ƒé¡ºåº</a>
    <a href="55--chapter5-5.html" class="next-link">ä¸‹ä¸€ç« ï¼š5.5. å»åºä»ç®€ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
          <section id="54--chapter5-4" class="section">
            <h2 class="section-title">5.4. é»‘æš—æ³•åˆ™</h2>
            <p>åœ¨C++è¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ªé²œä¸ºäººçŸ¥å´ä»¤äººé¢‡æ„Ÿæ„å¤–çš„â€œé»‘æš—è§’è½â€ â€”â€” å½“æŸäº›æºè‡ªè¿™ä¸€ç‰¹æ€§çš„ä»£ç å¶ç„¶å‡ºç°æ—¶ï¼Œä¼šè®©å¼€å‘è€…ä»¬é™·å…¥å›°æƒ‘ï¼Œç”šè‡³å¼•å‘å¤§è§„æ¨¡çš„é‡æ„ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯æ•°ç»„è®¿é—®çš„å†™æ³•ï¼šä¸ºä»€ä¹ˆåœ¨C++ä¸­ï¼Œa[2]ä¸2[a]æ˜¯å®Œå…¨ç­‰æ•ˆçš„ï¼Ÿ</p>

<pre><code class="language-cpp">int main() {
  int a[16] = {0};
  a[2] = 3;
  3[a] = 4;
}</code></pre>

<p>è¿™æ®µçœ‹ä¼¼æ€ªå¼‚çš„ä»£ç èƒ½å¤Ÿç¼–è¯‘ï¼Œå…¶æ ¹æœ¬åŸå› åœ¨äºï¼šæŒ‡é’ˆçš„ç®—æœ¯æœ¬è´¨ã€‚</p>

<ul>
    <li>a[i]å¯è½¬åŒ–ä¸º*(a + i)
  
  </li>  <li>i[a]åŒæ ·å¯è½¬åŒ–ä¸º*(i + a)
  
  </li>  <li>åŠ æ³•äº¤æ¢å¾‹ä½¿è¿™ä¸¤ç§å½¢å¼å®Œå…¨ç­‰ä»·
</ul>

<p>ç°ä»£å®¹å™¨çš„é™åˆ¶ã€‚std::vectorå’Œstd::arrayä¸æ”¯æŒè¿™ç§"ä¹±åº"è¯­æ³•ï¼š</p>

<ul>
  </li>  <li>è¿ç®—ç¬¦é‡è½½è§„åˆ™ï¼šoperator[]ä½œä¸ºæˆå‘˜å‡½æ•°å¿…é¡»é€šè¿‡å¯¹è±¡å®ä¾‹è°ƒç”¨
  
  </li>  <li>å®‰å…¨è®¾è®¡ç†å¿µï¼šå†…éƒ¨å®ç°é‡‡ç”¨è¾¹ç•Œæ£€æŸ¥è€ŒéåŸå§‹æŒ‡é’ˆç®—æœ¯
</ul>

<p>æ¨¡æ‹Ÿæ–¹æ¡ˆ(ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨)ï¼š</p>

</li><pre><code class="language-cpp">#include &lt;vector&gt;
#include &lt;iostream&gt;
struct wrapper {
  wrapper(int p) : i(p) {}
  int operator[](const std::vector&lt;int&gt; v) {return v[i];}
  int i = 0;
};
struct helper {
  helper() = default;
  wrapper operator &lt;&lt; (int a) { return wrapper {a}; }
};
#define _ helper()&lt;&lt;
int main() {
  std::vector&lt;int&gt; vec = {10, 20, 30, 40, 50};
  int b= (_ 2) [vec];
  std::cout &lt;&lt; b &lt;&lt; std::endl; // Outputs 30
  return 0;
}</code></pre>

<p>ç»è¿‡å¿«é€Ÿå®¡è§†è¿™æ®µä»£ç å(å£°æ˜ï¼šä¸¤ä½ä½œè€…ä¸­Alexæ˜¯æ— è¾œçš„ï¼Œæ­¤å¤„ä½¿ç”¨"æˆ‘ä»¬"ä»…æ˜¯è¡Œæ–‡æƒ¯ä¾‹)ï¼Œå¿…é¡»æ‰¿è®¤ â€”â€” è¿™æ®µä»£ç å®åœ¨éš¾ç™»å¤§é›…ä¹‹å ‚ï¼Œæ›´ä¸æ•¢å°†å…¶å®ç°åˆ°std::arrayæˆ–å…¶ä»–å®¹å™¨ä¸­ã€‚</p>

<p>ä½†ä»”ç»†çœ‹æ¥ï¼Œå…¶ä¸­ä»å­˜åœ¨æœ‰è¶£çš„æŠ€æœ¯ç‚¹ã€‚è™½ç„¶æœ€åˆç›®æ ‡æ˜¯å®ç°vector/arrayçš„æ— åºç´¢å¼•è®¿é—®ï¼Œä½†æ®‹é…·çš„ç°å®æ˜¯ï¼šè¿™æ ¹æœ¬ä¸å¯è¡Œã€‚å°è¯•ç¼–è¯‘2[vec]è¡¨è¾¾å¼æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼š</p>

<pre><code class="language-shell">error: no match for 'operator[]' (operand types are 'int' and 'std::vector&lt;int&gt;')</code></pre>

<p>è¿™ä¸ªé”™è¯¯ä¿¡æ¯ç›´ç™½åœ°è¯´å°±æ˜¯ï¼šç¼–è¯‘å™¨æ‰¾ä¸åˆ°ä¸€ä¸ªèƒ½æ¥å—æ•´å‹å‚æ•°å¹¶åº”ç”¨äºintå‘é‡çš„ä¸‹æ ‡è¿ç®—ç¬¦ã€‚åœ¨C++ç°æœ‰çš„è¯­æ³•ä½“ç³»ä¸‹ï¼Œè¿™ç§å†™æ³•æ°¸è¿œä¸å¯èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä¸»è¦åŸå› æœ‰äºŒï¼š</p>

<p>1. æˆå‘˜å‡½æ•°é™åˆ¶ï¼š</p>

<ul>
    <li>operator[]å¿…é¡»å®šä¹‰ä¸ºç±»çš„æˆå‘˜å‡½æ•°
  
  </li>  <li>C++ä¸å…è®¸å­˜åœ¨ç‹¬ç«‹çš„ä¸‹æ ‡è¿ç®—ç¬¦(ä¸å­˜åœ¨å…¨å±€çš„operator[])
</ul>

<p>2. è¿ç®—ç¬¦ä¼˜å…ˆçº§æœºåˆ¶ï¼š</p>

<ul>
  </li>  <li>åœ¨C++ä¸­ï¼Œæ“ä½œç¬¦ä¼˜å…ˆçº§(operator precedence)å†³å®šäº†è¡¨è¾¾å¼çš„è§£æé¡ºåº
  
  </li>  <li>é«˜ä¼˜å…ˆçº§è¿ç®—ç¬¦å…ˆäºä½ä¼˜å…ˆçº§è¿ç®—ç¬¦æ±‚å€¼
  
  </li>  <li>å½“ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œç”±ç»“åˆæ€§(associativity)å†³å®šæ±‚å€¼é¡ºåº
</ul>

<p>è™½ç„¶æœ€æ–°æ ‡å‡†ç¬¬7ç« [expr.pre]èŠ‚æŒ‡å‡º"è¿ç®—ç¬¦ä¼˜å…ˆçº§å¹¶éç›´æ¥è§„å®šï¼Œè€Œæ˜¯é€šè¿‡è¯­æ³•æ¨å¯¼"ï¼Œä½†ä»æœ‰æƒå¨èµ„æ–™<span class="footnote"><a href="https://en.cppreference.com/w/cpp/language/operator_precedence" target="_blank" rel="noopener noreferrer">https://en.cppreference.com/w/cpp/language/operator_precedence</a></span>å®Œæ•´åˆ—å‡ºäº†ä¼˜å…ˆçº§é¡ºåºè¡¨ â€”â€” å¼ºçƒˆå»ºè®®å¼€å‘è€…ç³»ç»Ÿé˜…è¯»è¿™äº›èµ„æ–™ã€‚</p>

<h4>5.4.1 æœ€å…³é”®çš„é—®é¢˜</h4>

<p>æ­¤åˆ»å„ä½è¯»è€…åº”è¯¥èƒ½è½»æ¾å›ç­”è¿™ä¸ªé—®é¢˜äº†ï¼šä¸‹é¢è¿™æ®µç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>

</li><pre><code class="language-cpp">#include &lt;iostream&gt;
int main() {
  auto a = 4;
  std::cout &lt;&lt; sizeof(a)[&quot;Hello World&quot;] &lt;&lt; std::endl;
  return 0;
}</code></pre>

<p>åœ¨å°†ä»£ç æ‰”è¿›ç¼–è¯‘å™¨ä¹‹å‰ï¼Œä¸å¦¨æš‚åœç‰‡åˆ»ï¼Œæ²‰ä¸‹å¿ƒæ¥ä»”ç»†æ¨æ•²å…¶ä¸­çš„è¿è¡Œæœºåˆ¶ã€‚æœ¬èŠ‚å·²ä¸ºæä¾›äº†æ‰€æœ‰è§£é¢˜çº¿ç´¢ â€”â€” ä»å…³é”®æç¤ºåˆ°æ½œåœ¨æ–¹å‘ä¸€åº”ä¿±å…¨ã€‚æˆ‘ä»¬æš‚ä¸æ­æ™“ç­”æ¡ˆï¼Œä¹Ÿä¸åšå®Œæ•´è§£æï¼Œä»…åˆ—å‡ºç°è±¡è¦ç‚¹ï¼Œç›¸ä¿¡è¿™äº›è¶³ä»¥å¸®åŠ©æ‚¨å¾—å‡ºæ­£ç¡®ç»“è®ºï¼š</p>

<ul>
    <li>åœ¨è¡¨è¾¾å¼ auto a = 4; ä¸­ï¼Œå˜é‡ a æ¨å¯¼ä¸º int ç±»å‹å¹¶åˆå§‹åŒ–ä¸º 4 â€”â€” è¿™æ­£æ˜¯ç°ä»£ C++ ä¸­ auto ä¸æ•´æ•°å­—é¢é‡çš„é…åˆæ–¹å¼ã€‚
  
  </li>  <li>æ¥ä¸‹æ¥æ˜¯ç²¾å¦™ä¹‹å¤„ï¼šé€šè¿‡ä»£ç è§£æå¯çŸ¥ï¼Œsizeof(a) è¡¨è¾¾å¼å°†è¿”å› sizeof(int) çš„å€¼ï¼š
  
  <ul>
    </li>  <li>ä¸»æµç³»ç»Ÿä¸­é€šå¸¸ä¸º 4 å­—èŠ‚
    
    </li>  <li>å¤è€çš„ 16 ä½ç³»ç»Ÿå¯èƒ½ä¸º 2 å­—èŠ‚
    
    </li>  <li>æŸäº›ç‰¹æ®Šæ¶æ„å¯èƒ½è¾¾åˆ° 8 å­—èŠ‚(è™½ç„¶ç¬”è€…ä»æœªäº²çœ¼è§è¿‡)
  </ul>
  
</ul>

<p>è¿™æ­£æ˜¯æ¨ç†çš„å…³é”®è½¬æŠ˜ç‚¹ â€”â€” C++çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§åœ¨æ­¤å‘æŒ¥äº†å†³å®šæ€§ä½œç”¨ã€‚ä»¥ä¸‹æ˜¯ä»ä¼˜å…ˆçº§è¡¨ä¸­æå–çš„ä¸å½“å‰æ¡ˆä¾‹ç›´æ¥ç›¸å…³çš„éƒ¨åˆ†ï¼š</p>

</li><table border="1">
  <thead>
    <tr>
      <th><strong>ä¼˜å…ˆçº§</strong></th>
      <th><strong>æ“ä½œç¬¦</strong></th>
      <th><strong>æè¿°</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>::</td>
      <td>å‘½åç©ºé—´è§£ææ“ä½œç¬¦</td>
    </tr>
    <tr>
      <td>2</td>
      <td>a++ <br> a--</td>
      <td>åç¼€è‡ªå¢å’Œè‡ªå‡</td>
    </tr>
    <tr>
      <td></td>
      <td>a()</td>
      <td>å‡½æ•°è°ƒç”¨</td>
    </tr>
    <tr>
      <td></td>
      <td>a[]</td>
      <td>ä¸‹æ ‡</td>
    </tr>
    <tr>
      <td>3</td>
      <td>++a <br> --a</td>
      <td>å‰ç¼€è‡ªå¢å’Œè‡ªå‡</td>
    </tr>
    <tr>
      <td></td>
      <td>+a <br> -a</td>
      <td>ä¸€å…ƒæ­£è´Ÿ</td>
    </tr>
    <tr>
      <td></td>
      <td>! ~</td>
      <td>é€»è¾‘éå’Œä½é</td>
    </tr>
    <tr>
      <td></td>
      <td>*a</td>
      <td>è§£å¼•ç”¨</td>
    </tr>
    <tr>
      <td></td>
      <td>&amp;a</td>
      <td>å–åœ°å€</td>
    </tr>
    <tr>
      <td></td>
      <td>sizeof</td>
      <td>sizeof(å†…å­˜å¤§å°)è¿ç®—ç¬¦</td>
    </tr>
  </tbody>
</table>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°åœ°ç†è§£ï¼šåœ¨è¿™æ®µä»£ç ä¸­ï¼Œsizeof(a)å®é™…ä¸Šå¹¶ä¸ä¼šè¢«çœŸæ­£æ‰§è¡Œã€‚è¿™æ˜¯ç”±äºC++ç¼–è¯‘å™¨åœ¨å¤„ç†è¿ç®—ç¬¦ä¼˜å…ˆçº§æ—¶çš„è§„åˆ™ â€”â€” [] è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äº sizeofï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼šä¼˜å…ˆè§£æ <code>(a)["Hello World"]</code> è¿™ä¸ªè¡¨è¾¾å¼ã€‚</p>

<p>å…³é”®è§£ææ­¥éª¤ï¼š</p>

<p>æ‹¬å·çš„ç­‰ä»·æ€§ï¼šåœ¨C++ä¸­ï¼Œ(a)åŸºæœ¬ç­‰åŒäºa(é™¤éé‡åˆ°"æœ€ä»¤äººå¤´ç–¼çš„è§£æ"åœºæ™¯ï¼Œè¿™ä¸ªæˆ‘ä»¬ç¨åå†è®¨è®º)ã€‚å› æ­¤æ•´ä¸ªè¡¨è¾¾å¼ç­‰ä»·äº<code>sizeof a["Hello World"]</code>ã€‚</p>

<p>æ•°ç»„è®¿é—®çš„å¯¹ç§°æ€§ï¼šå¦‚å‰æ‰€è¿°ï¼Œ<code>a["Hello World"]</code>ä¸<code>"Hello World"[a]</code>æ•ˆæœç›¸åŒã€‚å½“açš„å€¼ä¸º4æ—¶ï¼Œè¿™å°†è¿”å›å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦â€˜oâ€™ã€‚</p>

<p>sizeofè¿ç®—ç¬¦çš„ç‰¹æ€§ï¼šè¡¨è¾¾å¼æœ€ç»ˆç®€åŒ–ä¸º<code>sizeof 'o'</code>ï¼Œå¯¹äºcharç±»å‹ï¼Œsizeofè¿ç®—ç»“æœæ€»æ˜¯1ã€‚</p>

<p>è‡³æ­¤ï¼Œé—®é¢˜çš„ç­”æ¡ˆåº”è¯¥å·²ç»æ˜¾è€Œæ˜“è§äº†ã€‚</p>
          </section>
          
  <div class="navigation">
    <a href="53--chapter5-3.html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š5.3. æ€è€ƒé¡ºåº</a>
    <a href="55--chapter5-5.html" class="next-link">ä¸‹ä¸€ç« ï¼š5.5. å»åºä»ç®€ Â»</a>
  </div>
  <div class="back-to-toc"><a href="index.html">è¿”å›ç›®å½•</a></div>
  
        </div>
        
    </div>
    
    <!-- å…ˆåŠ è½½æ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- åŠ è½½MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
    
    <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      const themeToggle = document.createElement('button');
      themeToggle.className = 'theme-toggle';
      themeToggle.setAttribute('aria-label', 'åˆ‡æ¢ä¸»é¢˜');
      themeToggle.innerHTML = 'ğŸŒ“';
      document.body.appendChild(themeToggle);
      
      // æ·»åŠ æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜çš„æ ·å¼
      const darkThemeStyle = document.createElement('style');
      const lightThemeStyle = document.createElement('style');
      
      darkThemeStyle.textContent = `
        body.dark-theme {
          --background-color: #1a1a1a;
          --text-color: #e6e6e6;
          --code-bg-color: #2d2d2d;
          --link-color: #58a6ff;
          --highlight-color: #58a6ff;
          --border-color: #333;
          --table-border-color: #444;
          --table-header-bg: #2d2d2d;
          --blockquote-color: #aaa;
          --blockquote-border: #444;
          --part-header-bg: #222;
          --footer-text-color: #aaa;
          --filename-bg: #2d2d2d;
          --nav-bg: #2d2d2d;
          --nav-hover-bg: #444;
          --toc-bg: #222;
          --highlight-section-bg: #2d2d2d;
          --highlight-section-border: #58a6ff;
        }
      `;
      
      lightThemeStyle.textContent = `
        body.light-theme {
          --background-color: #ffffff;
          --text-color: #333333;
          --code-bg-color: #f5f5f5;
          --link-color: #0366d6;
          --highlight-color: #0366d6;
          --border-color: #eee;
          --table-border-color: #ddd;
          --table-header-bg: #f2f2f2;
          --blockquote-color: #666;
          --blockquote-border: #ddd;
          --part-header-bg: #f8f8f8;
          --footer-text-color: #666;
          --filename-bg: #f5f5f5;
          --nav-bg: #f5f5f5;
          --nav-hover-bg: #e6e6e6;
          --toc-bg: #f8f8f8;
          --highlight-section-bg: #f8f8f8;
          --highlight-section-border: #0366d6;
        }
      `;
      
      document.head.appendChild(darkThemeStyle);
      document.head.appendChild(lightThemeStyle);
      
      // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è®¾ç½®
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      const currentTheme = localStorage.getItem('theme');
      
      if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (currentTheme === 'light') {
        document.body.classList.add('light-theme');
      } else {
        // å¦‚æœæ²¡æœ‰ä¿å­˜çš„åå¥½ï¼Œè·Ÿéšç³»ç»Ÿ
        if (prefersDarkScheme.matches) {
          document.body.classList.add('dark-theme');
        } else {
          document.body.classList.add('light-theme');
        }
      }
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
      themeToggle.addEventListener('click', function() {
        console.log('Theme toggle clicked');
        if (document.body.classList.contains('dark-theme')) {
          document.body.classList.remove('dark-theme');
          document.body.classList.add('light-theme');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.remove('light-theme');
          document.body.classList.add('dark-theme');
          localStorage.setItem('theme', 'dark');
        }
      });
      
      // ç¡®ä¿ä»£ç å—æœ‰æ­£ç¡®çš„ç±»å
      document.querySelectorAll('pre code').forEach(function(block) {
        if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
          block.className = 'language-cpp';
        } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
          block.className = 'language-rust';
        } else if (!block.className) {
          block.className = 'language-plaintext';
        }
      });
      
      // å»¶è¿ŸåŠ è½½Prismé«˜äº®
      setTimeout(function() {
        if (window.Prism) {
          window.Prism.highlightAll();
        }
      }, 500);
    });
    </script>
  </body>
  </html>
  