
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.6. 鲜为人知的那些事 - 走出C++谜云</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script>
      window.MathJax = {"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]],"processEscapes":true,"tags":"ams"},"svg":{"fontCache":"global"}};
    </script>
    
  </head>
  <body>
    <div class="container">
      
        <div class="chapter-container">
          
  <div class="navigation">
    <a href="25-c-chapter2-5.html" class="prev-link">« 上一章：2.5. 头文件不符合C++规范时</a>
    <a href="27--chapter2-7.html" class="next-link">下一章：2.7. 未来之路 »</a>
  </div>
  <div class="back-to-toc"><a href="index.html">返回目录</a></div>
  
          <section id="26--chapter2-6" class="section">
            <h2 class="section-title">2.6. 鲜为人知的那些事</h2>
            <p>到目前为止，我们已经看到一些情况：是否遵循 C++ 标准，往往完全取决于开发者的个人选择。他们可以选择特定平台，使用自己喜爱的编译器所提供的扩展功能，或者坚持使用纯粹的标准 C++。</p>

<p>然而，在现实世界的广阔天地中，还存在某些并非出于自愿的情形 —— 由于环境施加了限制，导致我们无法使用 C++ 标准中的一些关键特性，从而难以实现标准合规。</p>

<p>暂且不谈那些令人不适的场景：比如我们必须维护几十年前遗留下来的代码库，这些代码诞生于 C++ 的“黄金时代”（也就是标准化委员会尚未接管之前的时代），那个年代充满了自由与混乱 —— 就像 BASIC 曾经带来的各种方言泛滥一样。在现实项目中，我们有时会遇到一些无法控制的情况，迫使我们放弃对完整 C++ 标准的支持：</p>

<ul>
    <li>某些项目明确禁止使用异常机制
  
  </li>  <li>有些运行环境缺乏对动态内存分配的可靠支持
  
  </li>  <li>还有一些嵌入式或底层系统要求我们直接向硬件地址写入数据才能实现特定功能
</ul>

<p>不过，即使是最后一种情形，也仍然可以通过符合标准的方式实现。</p>

<p>以嵌入式系统为例，许多这类平台积极鼓励开发者使用其专有的汇编指令。我们知道，在现代 C++ 中，并不存在所谓“平台无关的汇编语言” —— 因为到了这个层级，已经是软件所能触及的最低抽象层了。再往下就是纯十六进制的机器码，而那个需要手动编写机器指令的时代早已一去不复返。</p>

<p>还有一种常见情况是：硬件对代码行为提出了严格的要求，必须具备确定性行为：</p>

<ul>
  </li>  <li>异常机制被排除在外（谁愿意在每一纳秒的执行流程中都无法准确追踪程序状态？）
  
  </li>  <li>动态内存分配也被摒弃（因为分配延迟、内存碎片等问题会导致不确定性行为）
</ul>

<p>在这种情况下，C++ 标准中的大量特性就不得不被舍弃。</p>

<p>为了解决这些问题，嵌入式领域发展出了一些替代方案，例如：</p>

<ul>
  </li>  <li>使用内存池或对象池
  
  </li>  <li>在编译期进行静态资源分配
  
  </li>  <li>或者采用其他形式的定制化资源管理策略 —— 其中不少方法甚至是平台定制的
</ul>

<p>至于异常机制，情况则更为复杂。在 Bjarne Stroustrup 的一篇精彩论文中<span class="footnote"><a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1947r0.pdf" target="_blank" rel="noopener noreferrer">https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1947r0.pdf</a></span>，他探讨了用诸如“确定性异常”等替代机制取代现有异常处理模型所面临的挑战、成本与潜在风险。</p>

<p>正如该文所指出的那样，目前尚无明确证据表明，我们应该彻底抛弃现有的异常机制。那样做只会加剧本已严重的 C++ 社区碎片化问题。相反，作者主张应将重点放在增强当前的异常处理系统上，而不是通过引入新的机制来使语言变得更加复杂。他强调：尽管异常机制并不完美，但它在过去几十年中有效地服务了无数开发者，依然是一个经过实战检验的重要工具。</p>

</li>
          </section>
          
  <div class="navigation">
    <a href="25-c-chapter2-5.html" class="prev-link">« 上一章：2.5. 头文件不符合C++规范时</a>
    <a href="27--chapter2-7.html" class="next-link">下一章：2.7. 未来之路 »</a>
  </div>
  <div class="back-to-toc"><a href="index.html">返回目录</a></div>
  
        </div>
        
    </div>
    
    <!-- 先加载核心库 -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- 加载MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
    
    <!-- 主题切换脚本 -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 创建主题切换按钮
      const themeToggle = document.createElement('button');
      themeToggle.className = 'theme-toggle';
      themeToggle.setAttribute('aria-label', '切换主题');
      themeToggle.innerHTML = '🌓';
      document.body.appendChild(themeToggle);
      
      // 添加深色和浅色主题的样式
      const darkThemeStyle = document.createElement('style');
      const lightThemeStyle = document.createElement('style');
      
      darkThemeStyle.textContent = `
        body.dark-theme {
          --background-color: #1a1a1a;
          --text-color: #e6e6e6;
          --code-bg-color: #2d2d2d;
          --link-color: #58a6ff;
          --highlight-color: #58a6ff;
          --border-color: #333;
          --table-border-color: #444;
          --table-header-bg: #2d2d2d;
          --blockquote-color: #aaa;
          --blockquote-border: #444;
          --part-header-bg: #222;
          --footer-text-color: #aaa;
          --filename-bg: #2d2d2d;
          --nav-bg: #2d2d2d;
          --nav-hover-bg: #444;
          --toc-bg: #222;
          --highlight-section-bg: #2d2d2d;
          --highlight-section-border: #58a6ff;
        }
      `;
      
      lightThemeStyle.textContent = `
        body.light-theme {
          --background-color: #ffffff;
          --text-color: #333333;
          --code-bg-color: #f5f5f5;
          --link-color: #0366d6;
          --highlight-color: #0366d6;
          --border-color: #eee;
          --table-border-color: #ddd;
          --table-header-bg: #f2f2f2;
          --blockquote-color: #666;
          --blockquote-border: #ddd;
          --part-header-bg: #f8f8f8;
          --footer-text-color: #666;
          --filename-bg: #f5f5f5;
          --nav-bg: #f5f5f5;
          --nav-hover-bg: #e6e6e6;
          --toc-bg: #f8f8f8;
          --highlight-section-bg: #f8f8f8;
          --highlight-section-border: #0366d6;
        }
      `;
      
      document.head.appendChild(darkThemeStyle);
      document.head.appendChild(lightThemeStyle);
      
      // 检查本地存储中的设置
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      const currentTheme = localStorage.getItem('theme');
      
      if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
      } else if (currentTheme === 'light') {
        document.body.classList.add('light-theme');
      } else {
        // 如果没有保存的偏好，跟随系统
        if (prefersDarkScheme.matches) {
          document.body.classList.add('dark-theme');
        } else {
          document.body.classList.add('light-theme');
        }
      }
      
      // 添加点击事件监听器
      themeToggle.addEventListener('click', function() {
        console.log('Theme toggle clicked');
        if (document.body.classList.contains('dark-theme')) {
          document.body.classList.remove('dark-theme');
          document.body.classList.add('light-theme');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.remove('light-theme');
          document.body.classList.add('dark-theme');
          localStorage.setItem('theme', 'dark');
        }
      });
      
      // 确保代码块有正确的类名
      document.querySelectorAll('pre code').forEach(function(block) {
        if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
          block.className = 'language-cpp';
        } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
          block.className = 'language-rust';
        } else if (!block.className) {
          block.className = 'language-plaintext';
        }
      });
      
      // 延迟加载Prism高亮
      setTimeout(function() {
        if (window.Prism) {
          window.Prism.highlightAll();
        }
      }, 500);
    });
    </script>
  </body>
  </html>
  