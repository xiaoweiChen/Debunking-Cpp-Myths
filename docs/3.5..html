
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3.5. å¼ºç±»å‹çš„æé™ - èµ°å‡ºC++è°œäº‘</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
  <script>
    window.MathJax = {'tex': {'inlineMath': [['$', '$'], ['\\(', '\\)']], 'displayMath': [['$$', '$$'], ['\\[', '\\]']], 'processEscapes': 'true', 'tags': 'ams'}, 'svg': {'fontCache': 'global'}};
  </script>
  
</head>

<body>
  <div class="container">
    
<div class="chapter-container">
  
<div class="navigation">
  <a href="3.4..html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š3.4. å…ƒç¼–ç¨‹</a>
  <a href="3.6..html" class="next-link">ä¸‹ä¸€ç« ï¼š3.6. å¿½ç•¥ç±»å‹ Â»</a>
</div>
<div class="back-to-toc" style="text-align:left"><a href="index.html">è¿”å›ç›®å½•</a></div>
  <section class="section"><h1 class="section-title">3.5. å¼ºç±»å‹çš„æé™</h1></section>
  <p class="zh">åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€å°±æ˜¯é¿å… bugã€‚è¿™ä¸ªé—®é¢˜å¦‚æ­¤æ™®éï¼Œä»¥è‡³äºæˆ‘ä»¬ä¸“é—¨ç”¨â€œbugâ€è¿™ä¸ªè¯æ¥å½¢å®¹å®ƒï¼Œä»¿ä½›ä»£ç å‡ºé”™æ˜¯ä¸€ç§ä¸å¯é¿å…çš„ç°è±¡ã€‚ä½†äº‹å®ä¸Šï¼Œå¤§å¤šæ•°æ‰€è°“çš„â€œbugâ€æœ¬è´¨ä¸Šåªæ˜¯å¼€å‘è€…çŠ¯ä¸‹çš„é”™è¯¯ï¼ˆmistakesï¼‰ã€‚</p>
<p class="zh">æ—¢ç„¶æˆ‘ä»¬æ‹¥æœ‰ç¼–è¯‘å™¨ï¼Œé‚£ä¸ºä»€ä¹ˆä¸åˆ©ç”¨å®ƒæ¥æ–½åŠ è¶³å¤Ÿçš„é™åˆ¶ï¼Œä½¿å¾—ä¸€æ—¦å‡ºç°æ½œåœ¨é—®é¢˜ï¼Œç¼–è¯‘å™¨å°±èƒ½ç«‹å³é€šçŸ¥æˆ‘ä»¬å‘¢ï¼Ÿç†è®ºä¸Šæˆ‘ä»¬å®Œå…¨å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œåªä¸è¿‡è¿™éœ€è¦ä»˜å‡ºä¸€å®šçš„è®¾è®¡ä¸å®ç°æˆæœ¬ã€‚</p>
<p class="zh">åœ¨å‰ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æ¨¡æ¿å…ƒç¼–ç¨‹ï¼ˆtemplate metaprogrammingï¼‰ï¼Œä½†æˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼šæ¨¡æ¿å…ƒç¼–ç¨‹æ˜¯å›¾çµå®Œå¤‡çš„ï¼ˆTuring completeï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä»»ä½•å¯ä»¥ç”¨å¸¸è§„æ–¹å¼å†™å‡ºçš„ç¨‹åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å…ƒç¼–ç¨‹åœ¨ç¼–è¯‘æ—¶å®Œæˆã€‚</p>
<p class="zh">è¿™ä¸€æ€æƒ³éå¸¸å¼ºå¤§ï¼Œä¹Ÿåœ¨å¤šä¸ªé¢†åŸŸè¢«å¹¿æ³›æ¢è®¨ã€‚å¦‚æœä½ æƒ³å°è¯•ä¸€é—¨å®Œå…¨å›´ç»•è¿™ä¸€ç†å¿µæ„å»ºçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸å¦¨è¯•è¯• Idris(<a href="https://www.idris-lang.org/" target="_blank" rel="noopener noreferrer">https://www.idris-lang.org/</a>)ã€‚è®¸å¤šå¼€å‘è€…å¯èƒ½ä¹Ÿç†Ÿæ‚‰ Haskell ä¸­åœ¨ç¼–è¯‘æœŸè¿›è¡ŒéªŒè¯çš„èƒ½åŠ›ã€‚è€Œæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯åœ¨ Andrei Alexandrescu äº 2001 å¹´å‡ºç‰ˆçš„å¼€åˆ›æ€§è‘—ä½œã€ŠModern C++ Design: Generic Programming and Design Patterns Appliedã€‹ä¸­ã€‚</p>
<p class="zh">è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„é—®é¢˜å…¥æ‰‹ã€‚â€œåŸå§‹ç±»å‹ç—´è¿·â€ æ˜¯å¯¼è‡´ bug å’Œä»£ç å¼‚å‘³çš„ä¸€ä¸ªå¸¸è§æ¥æºã€‚å®ƒæŒ‡çš„æ˜¯è¿‡åº¦ä¾èµ–åŸå§‹ç±»å‹ï¼ˆå¦‚ int æˆ– doubleï¼‰æ¥è¡¨ç¤ºæœ¬åº”æ›´å¤æ‚çš„è¯­ä¹‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå°†é•¿åº¦ã€é‡‘é¢ã€æ¸©åº¦æˆ–é‡é‡ç­‰å€¼ç®€å•åœ°è¡¨ç¤ºä¸ºæ•°å­—ï¼Œå´å¿½ç•¥äº†å®ƒä»¬æ‰€ä»£è¡¨çš„å•ä½å’Œå«ä¹‰ã€‚</p>
<p class="zh">ä¸å…¶è¿™æ ·ï¼Œä¸å¦‚ä¸ºè¿™äº›æ¦‚å¿µå®šä¹‰ç‰¹å®šçš„ç±»å‹ã€‚ä»¥â€œé‡‘é¢â€ä¸ºä¾‹ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«ä¸Šä¸‹æ–‡ç²¾åº¦æ§åˆ¶çš„å€¼ï¼ˆæ¯”å¦‚ä¼šè®¡ç³»ç»Ÿä¸­å¸¸ç”¨çš„ä¸ƒä½å°æ•°ï¼‰ä»¥åŠè´§å¸ç§ç±»çš„å°è£…ç±»å‹ã€‚å³ä½¿å½“å‰ç³»ç»Ÿåªå¤„ç†ä¸€ç§è´§å¸ï¼Œè¿™ç§åšæ³•ä»ç„¶éå¸¸æœ‰ä»·å€¼ â€”â€” å› ä¸ºä½ å‡ ä¹å¯ä»¥è‚¯å®šä¸€ä»¶äº‹ï¼šéšç€åŠŸèƒ½ä¸æ–­å¢åŠ ï¼ŒåŸæœ¬åªæ”¯æŒå•ä¸€è´§å¸çš„ç³»ç»Ÿï¼Œæœ€ç»ˆå¾ˆå¯èƒ½éœ€è¦æ”¯æŒå¤šç§è´§å¸ã€‚</p>
<p class="zh">ä¸â€œåŸå§‹ç±»å‹ç—´è¿·â€å¯†åˆ‡ç›¸å…³çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•å¯¹åŸå§‹ç±»å‹çš„å–å€¼èŒƒå›´è¿›è¡Œçº¦æŸã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¡¨ç¤ºä¸€å¤©ä¸­å°æ—¶æ•°çš„å€¼ï¼Œä¸åº”è¯¥åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ unsigned intï¼Œè€Œå¿…é¡»åœ¨ 0 åˆ° 23 çš„èŒƒå›´å†…ï¼ˆè¿™é‡Œæˆ‘ä»¬å‡è®¾ä½¿ç”¨çš„æ˜¯ 24 å°æ—¶åˆ¶ï¼‰ã€‚å¦‚æœæˆ‘ä»¬èƒ½å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œä»»ä½•ä¸åœ¨ 0 åˆ° 23 èŒƒå›´å†…çš„å€¼éƒ½ä¸èƒ½ä½œä¸ºåˆæ³•çš„å°æ—¶æ•°â€ï¼Œå¹¶åœ¨ä¼ å…¥éæ³•å€¼ï¼ˆå¦‚ 27ï¼‰æ—¶ç»™å‡ºæ˜ç¡®çš„é”™è¯¯æç¤ºï¼Œé‚£å°±å†å¥½ä¸è¿‡äº†ã€‚</p>
<p class="zh">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºå–å€¼æœ‰é™ï¼Œä½¿ç”¨ enum å¯èƒ½æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ä½†ä¸ºäº†è¯´æ˜è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶ä¸¤ç§ä¸åŒç­–ç•¥çš„è®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªè¿è¡Œæ—¶çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º Hour çš„ç±»ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­å¯¹è¾“å…¥å€¼è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œå¹¶åœ¨éæ³•æ—¶æŠ›å‡ºå¼‚å¸¸ï¼š</p>
<pre class="line-numbers"><code class="language-cpp">class Hour{
private:
  int theValue = 0;
  void setValue(int candidateValue) {
    if(candidateValue &gt;= 0 &amp;&amp; candidateValue &lt;= 23){
      theValue = candidateValue;
    }
    else{
      throw std::out_of_range(&quot;Value out of range&quot;);
    }
  }

public:
  Hour(int theValue){
    setValue(theValue);
  }

  int value() const {
    return theValue;
  }
};

TEST_CASE(&quot;Valid hour&quot;){
  Hour hour(10);
  CHECK_EQ(10, hour.value());
}

TEST_CASE(&quot;Invalid hour&quot;){
  CHECK_THROWS(Hour(30));
}</code></pre>
<p class="zh">é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å°†è¿™ç§æ£€æŸ¥æå‰åˆ°ç¼–è¯‘æ—¶åˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™æ—¶å°±è½®åˆ° constexpr å¤§æ˜¾èº«æ‰‹äº†ã€‚æˆ‘ä»¬å¯ä»¥ç»“åˆ static_assert æ¥åœ¨ç¼–è¯‘æœŸéªŒè¯æ•°å€¼æ˜¯å¦åˆæ³•ï¼š</p>
<pre class="line-numbers"><code class="language-cpp">template &lt;int Min, int Max&gt;
class RangedInteger{
private:
  int theValue;
  constexpr RangedInteger(int theValue) : theValue(theValue) {}
public:
  template &lt;int CandidateValue&gt;
  static constexpr RangedInteger make() {
    static_assert(CandidateValue &gt;= Min &amp;&amp; CandidateValue &lt;= Max, &quot;Value out of range.&quot;);
    return CandidateValue;
  }

  constexpr int value() const {
    return theValue;
  }
};

using Hour = RangedInteger&lt;0, 23&gt;</code></pre>
<p class="zh">åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œä¸‹é¢è¿™æ®µæµ‹è¯•ä»£ç å¯ä»¥å®Œç¾è¿è¡Œï¼š</p>
<pre class="line-numbers"><code class="language-cpp">TEST_CASE(&quot;Valid hour&quot;){
  constexpr Hour h = Hour::make&lt;10&gt;();

  CHECK_EQ(10, h.value());
}</code></pre>
<p class="zh">ä½†å¦‚æœå°è¯•ä¼ é€’ä¸€ä¸ªè¶…å‡ºèŒƒå›´çš„å€¼ï¼Œå°±ä¼šè§¦å‘ç¼–è¯‘é”™è¯¯ï¼š</p>
<pre><code class="language-shell">TEST_CASE("Invalid hour"){
  constexpr Hour h2 = Hour::make&lt;30&gt;();
}
Hour.h: In instantiation of 'static constexpr RangedInteger&lt;Min, Max&gt;
RangedInteger&lt;Min, Max&gt;::make() [with int CandidateValue = 30; int Min
= 0; int Max = 23]':
Hour.h:11:87: error: static assertion failed: Value out of range.
   11 | static_assert(CandidateValue &gt;= Min &amp;&amp; CandidateValue &lt;= Max, "Value out of range.");
      |                                        ~~~~~~~~~~~~~~~^~~~~~
Hour.h:11:87: note: '(30 &lt;= 23)' evaluates to false</code></pre>
<p class="zh">è¿™æ¡é”™è¯¯ä¿¡æ¯æ¸…æ¥šåœ°å‘Šè¯‰æˆ‘ä»¬ï¼š30 ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å°æ—¶å€¼ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼</p>
<p class="zh">è¿™åªæ˜¯ä¼—å¤šæŠ€å·§ä¸­çš„ä¸€ç§ï¼Œé€‚ç”¨äºå¸Œæœ›ç¼–å†™å‡ºåœ¨ç¼–è¯‘æ—¶å°±èƒ½è¯æ˜è®¡ç®—åˆæ³•æœ‰æ•ˆçš„ C++ ç¨‹åºã€‚æ¨¡æ¿å…ƒç¼–ç¨‹æ˜¯å›¾çµå®Œå¤‡çš„ï¼Œç†è®ºä¸Šå¯ä»¥åœ¨ç¼–è¯‘æ—¶å®ç°ä»»ä½•è¿è¡Œæ—¶èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚å½“ç„¶ï¼Œè¿™å…¶ä¸­ä¹Ÿå­˜åœ¨æƒè¡¡ã€‚</p>
<p class="zh">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ Hour å€¼å¿…é¡»æ˜¯ constexpr çš„ï¼Œä¼šç›´æ¥åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™æ˜¯æœ‰æ„ä¸ºä¹‹çš„ï¼Œè¦å°†ç±»å‹çº¦æŸå‘æŒ¥åˆ°æè‡´ï¼Œå”¯ä¸€çš„æ–¹æ³•å°±æ˜¯å°†å…¶ç›´æ¥ç¼–è¯‘è¿›ç¨‹åºå•å…ƒä¸­ã€‚</p>
<p class="zh">åœ¨å®è·µä¸­ï¼Œæˆ‘å‘ç°è¿™ç±»æŠ€æœ¯è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿå®¹æ˜“è®©ä»£ç å˜å¾—æå…¶éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ä¿®æ”¹è¿™ç±»ä»£ç éœ€è¦æé«˜çš„çºªå¾‹æ€§ï¼Œå› ä¸ºå“ªæ€•æ˜¯ä¸€ç‚¹ç‚¹æ”¹åŠ¨ï¼Œä¹Ÿå¯èƒ½å¼•å…¥æ–°çš„ bug â€”â€” è¿™äº› bug æœ¬æ¥å¯ä»¥é€šè¿‡å¼ºç±»å‹æœºåˆ¶é¿å…ã€‚åŸºæœ¬åŸåˆ™å§‹ç»ˆæ˜¯ï¼šå¤šç”¨æ‰©å±•çš„æ–¹å¼æ·»åŠ æ–°åŠŸèƒ½ï¼Œå°‘å»ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œé™¤éæ˜¯ä¸ºäº†ä¿®å¤é—®é¢˜ã€‚</p>
<p class="zh">ç›®å‰æˆ‘ä»¬çš„ç¤ºä¾‹è¿˜ç®—ç®€æ´æ¸…æ™°ï¼Œä½†éšç€ç±»å‹æŠ½è±¡å±‚æ¬¡çš„åŠ æ·±ï¼Œå…­ä¸ªæœˆåå†å›çœ‹å½“åˆçš„è®¾è®¡æ€è·¯æ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°å¾ˆéš¾è¿˜åŸå…¶èƒŒåçš„é€»è¾‘ã€‚ä»ç§¯æçš„ä¸€é¢æ¥çœ‹ï¼Œè¿™ç§æŠ€æœ¯éå¸¸é€‚åˆç”¨äºå¼€å‘ä¸“æ³¨äºç‰¹å®šé¢†åŸŸçš„ç±»åº“ã€‚</p>
<p class="zh">è™½ç„¶æˆ‘è®¤ä¸ºè¿™ç§æŠ€æœ¯éå¸¸æœ‰è¶£ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­æˆ‘æ›´å€¾å‘äºä¿ç•™æ›´å¤§çš„è‡ªç”±åº¦ã€‚æˆ‘ä¼šé‡‡ç”¨è‡ªå·±çš„ä¸€å¥—æ–¹æ³•ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰ã€æŒç»­é‡æ„ã€æè‡´å…³æ³¨å‘½åè´¨é‡ä»¥åŠè¿½æ±‚ç®€å•è®¾è®¡ã€‚æˆ‘æ›´å¸Œæœ›æœ‰ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘å†™å‡ºæˆ‘æƒ³å†™çš„ä»£ç ï¼Œè€Œè®©ç¼–è¯‘å™¨å»å¤„ç†é‚£äº›ç¹ççš„ç»†èŠ‚ã€‚</p>
<p class="zh">æ­£å› å¦‚æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘è¦ä»‹ç»çš„æœ€åä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä¼šå°½å¯èƒ½åœ°æ·¡åŒ–ç±»å‹çš„å½±å“ï¼Œä»è€Œæä¾›å¦ä¸€ç§è§†è§’æ¥çœ‹å¾…ç¨‹åºè®¾è®¡ä¸å®ç°ã€‚</p>
  <div class="back-to-toc" style="text-align:left"><a href="index.html">è¿”å›ç›®å½•</a></div>
<div class="navigation">
  <a href="3.4..html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š3.4. å…ƒç¼–ç¨‹</a>
  <a href="3.6..html" class="next-link">ä¸‹ä¸€ç« ï¼š3.6. å¿½ç•¥ç±»å‹ Â»</a>
</div>

</div>

  </div>
  <!-- å…ˆåŠ è½½æ ¸å¿ƒåº“ -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <!-- è¡Œå·æ’ä»¶ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

  <!-- å¤åˆ¶æŒ‰é’®éœ€è¦çš„ toolbar æ’ä»¶ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css">
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>

  <!-- Copy to clipboard æ’ä»¶ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.css">
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
  
  <!-- åŠ è½½MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
  
  <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
    const themeToggle = document.createElement('button');
    themeToggle.className = 'theme-toggle';
    themeToggle.setAttribute('aria-label', 'åˆ‡æ¢ä¸»é¢˜');
    themeToggle.innerHTML = 'ğŸŒ“';
    document.body.appendChild(themeToggle);
    
    // æ·»åŠ æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜çš„æ ·å¼
    const darkThemeStyle = document.createElement('style');
    const lightThemeStyle = document.createElement('style');
    
    darkThemeStyle.textContent = `
      body.dark-theme {
        --background-color: #1a1a1a;
        --text-color: #e6e6e6;
        --code-bg-color: #2d2d2d;
        --link-color: #58a6ff;
        --highlight-color: #58a6ff;
        --border-color: #333;
        --table-border-color: #444;
        --table-header-bg: #2d2d2d;
        --blockquote-color: #aaa;
        --blockquote-border: #444;
        --part-header-bg: #222;
        --footer-text-color: #aaa;
        --filename-bg: #2d2d2d;
        --nav-bg: #2d2d2d;
        --nav-hover-bg: #444;
        --toc-bg: #222;
        --highlight-section-bg: #2d2d2d;
        --highlight-section-border: #58a6ff;
      }
    `;
    
    lightThemeStyle.textContent = `
      body.light-theme {
        --background-color: #ffffff;
        --text-color: #333333;
        --code-bg-color: #f5f5f5;
        --link-color: #0366d6;
        --highlight-color: #0366d6;
        --border-color: #eee;
        --table-border-color: #ddd;
        --table-header-bg: #f2f2f2;
        --blockquote-color: #666;
        --blockquote-border: #ddd;
        --part-header-bg: #f8f8f8;
        --footer-text-color: #666;
        --filename-bg: #f5f5f5;
        --nav-bg: #f5f5f5;
        --nav-hover-bg: #e6e6e6;
        --toc-bg: #f8f8f8;
        --highlight-section-bg: #f8f8f8;
        --highlight-section-border: #0366d6;
      }
    `;
    
    document.head.appendChild(darkThemeStyle);
    document.head.appendChild(lightThemeStyle);
    
    // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è®¾ç½®
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme');
    
    if (currentTheme === 'dark') {
      document.body.classList.add('dark-theme');
    } else if (currentTheme === 'light') {
      document.body.classList.add('light-theme');
    } else {
      // å¦‚æœæ²¡æœ‰ä¿å­˜çš„åå¥½ï¼Œè·Ÿéšç³»ç»Ÿ
      if (prefersDarkScheme.matches) {
        document.body.classList.add('dark-theme');
      } else {
        document.body.classList.add('light-theme');
      }
    }
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    themeToggle.addEventListener('click', function() {
      console.log('Theme toggle clicked');
      if (document.body.classList.contains('dark-theme')) {
        document.body.classList.remove('dark-theme');
        document.body.classList.add('light-theme');
        localStorage.setItem('theme', 'light');
      } else {
        document.body.classList.remove('light-theme');
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
      }
    });
    
    // ç¡®ä¿ä»£ç å—æœ‰æ­£ç¡®çš„ç±»å
    document.querySelectorAll('pre code').forEach(function(block) {
      if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
        block.className = 'language-cpp';
      } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
        block.className = 'language-rust';
      } else if (!block.className) {
        block.className = 'language-plaintext';
      }
    });
    
    // å»¶è¿ŸåŠ è½½Prismé«˜äº®
    setTimeout(function() {
      if (window.Prism) {
        window.Prism.highlightAll();
      }
    }, 500);
  });
  </script>
</body>
</html>