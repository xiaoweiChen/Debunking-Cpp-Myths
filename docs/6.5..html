
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6.5. ç°ä»£C++çš„å±€é™æ€§ - èµ°å‡ºC++è°œäº‘</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
  <script>
    window.MathJax = {'tex': {'inlineMath': [['$', '$'], ['\\(', '\\)']], 'displayMath': [['$$', '$$'], ['\\[', '\\]']], 'processEscapes': 'true', 'tags': 'ams'}, 'svg': {'fontCache': 'global'}};
  </script>
  
</head>

<body>
  <div class="container">
    
<div class="chapter-container">
  
<div class="navigation">
  <a href="6.4..html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š6.4. ç°ä»£C++çš„æ•‘èµ</a>
  <a href="6.6..html" class="next-link">ä¸‹ä¸€ç« ï¼š6.6. ä»éœ€åŠªåŠ› Â»</a>
</div>
<div class="back-to-toc" style="text-align:left"><a href="index.html">è¿”å›ç›®å½•</a></div>
  <section class="section"><h1 class="section-title">6.5. ç°ä»£C++çš„å±€é™æ€§</h1></section>
  <p>å‡è®¾æˆ‘ä»¬ä»…ä½¿ç”¨ STL å®¹å™¨ã€é¿å…è£¸æŒ‡é’ˆï¼Œåœ¨å¿…è¦æ—¶é‡‡ç”¨æ ‡å‡†åº“æä¾›çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå¹¶å§‹ç»ˆä»¥å†…å­˜å®‰å…¨ä¸ºå‡†åˆ™æ¥è®¾è®¡ç±»å‹ â€”â€” è¿™æ ·å°±çœŸçš„å¯ä»¥é«˜æ•æ— å¿§äº†å—ï¼Ÿ</p>
<p>C++ æ ‡å‡†å§”å‘˜ä¼šçŸ¥åæˆå‘˜ Herb Sutter åœ¨å…¶ 2024 å¹´ 3 æœˆ 11 æ—¥å‘è¡¨çš„åšå®¢ã€ŠC++ å®‰å…¨æ€§çš„ç°çŠ¶ä¸æ€è€ƒã€‹(<a href="https://herbsutter.com/2024/03/11/safety-in-context/" target="_blank" rel="noopener noreferrer">https://herbsutter.com/2024/03/11/safety-in-context/</a>) ä¸­ï¼Œæ·±å…¥æ¢è®¨äº†è¿™ä¸€é—®é¢˜ã€‚ä»–çš„ç»“è®ºæ˜¯ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒC++ ä»£ç ä»ç„¶å¤ªå®¹æ˜“å¼•å…¥å®‰å…¨éšæ‚£ã€‚æ–‡ç« æŒ‡å‡ºï¼Œæœ‰å››ä¸ªå…³é”®é¢†åŸŸäºŸéœ€é‡ç‚¹å…³æ³¨ï¼šç±»å‹ç³»ç»Ÿã€è¾¹ç•Œæ£€æŸ¥ã€åˆå§‹åŒ–æœºåˆ¶ä»¥åŠç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å°½ç®¡ C++20 å·²ç»å¼•å…¥äº†ä¸€äº›åˆæ­¥è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ std::spanã€std::string_viewã€concepts å’ŒèŒƒå›´æ„ŸçŸ¥æœºåˆ¶ï¼‰ï¼Œä½†è¯­è¨€å±‚é¢ä»ç¼ºä¹ä¸€å¥—â€œé»˜è®¤å¼€å¯ã€æŒ‰éœ€å…³é—­â€çš„å®‰å…¨è§„åˆ™ä½“ç³»ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç»“åˆå…·ä½“å®ä¾‹ï¼Œè§£æè¿™äº›è§‚ç‚¹ã€‚</p>
<p>é¦–å½“å…¶å†²çš„æ˜¯C++20å¼•å…¥çš„std::span â€”â€” std::span è¡¨ç¤ºå¯¹ä¸€æ®µè¿ç»­å†…å­˜ï¼ˆä¾‹å¦‚åŸç”Ÿæ•°ç»„ã€std::arrayã€å¸¦å°ºå¯¸çš„æŒ‡é’ˆã€std::vector æˆ– std::stringï¼‰çš„å®‰å…¨è§†å›¾ã€‚å®ƒæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿè‡ªåŠ¨æ¨å¯¼å‡ºåºåˆ—çš„é•¿åº¦ï¼Œä»è€Œæœ‰æ•ˆæœç»å¸¸è§çš„â€œå·®ä¸€é”™è¯¯â€ï¼ˆoff-by-one errorsï¼‰ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ï¼šå®‰å…¨åœ°å‘å‡½æ•°ä¼ é€’é›†åˆçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ— éœ€æ‹…å¿ƒè¶Šç•Œè®¿é—®ï¼›å½»åº•ç¦ç”¨ä¸å®‰å…¨çš„æŒ‡é’ˆç®—æœ¯è¿ç®—ï¼Œè½¬è€Œä½¿ç”¨ std::span ä½œä¸ºæ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>å…¶æ¬¡æ˜¯ string_viewã€‚std::string_view æä¾›äº†ä¸€ç§å¯¹å­—ç¬¦ä¸²å†…å®¹çš„åªè¯»è®¿é—®æ–¹å¼ï¼Œæå¤§åœ°å‡å°‘äº†å› æ„å¤–ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹è€Œå¯¼è‡´çš„å®‰å…¨éšæ‚£ã€‚æ­¤å¤–ï¼Œè¿˜æ¶ˆé™¤äº†è®¸å¤šåŸæœ¬ä¸å®‰å…¨çš„å­—ç¬¦ä¸²æ“ä½œæ¨¡å¼ï¼Œæ¯”å¦‚ä¸å¿…è¦çš„å¤åˆ¶å’Œæ ¼å¼é”™è¯¯ã€‚</p>
<p>ç¬¬ä¸‰æ˜¯æ¦‚å¿µ(concepts)ã€‚æ¦‚å¿µå…è®¸å¼€å‘è€…ä¸ºæ³›å‹å‡½æ•°æˆ–ç±»æ–½åŠ æ¸…æ™°çš„çº¦æŸæ¡ä»¶ï¼Œä»è€Œå¢å¼ºç±»å‹å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ˜ç¡®è¦æ±‚æŸä¸ªæ³›å‹å‡½æ•°çš„å‚æ•°ç±»å‹å¿…é¡»æ”¯æŒåŠ æ³•å’Œå‡æ³•è¿ç®—ã€‚è™½ç„¶ concepts çš„è®¾è®¡ä»åœ¨æŒç»­æ¼”è¿›ï¼ˆC++26 å°†å¸¦æ¥æ›´å¤šæ”¹è¿›ï¼‰ï¼Œä½†å®ƒä»¬å·²ç»èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§„é¿å¤§é‡æ½œåœ¨çš„å®‰å…¨ç¼ºé™·ã€‚</p>
<p>ç¬¬å››æ˜¯è¾¹ç•Œæ„ŸçŸ¥çš„èŒƒå›´(bound-aware ranges)ã€‚C++20 ä¸­å¼•å…¥çš„èŒƒå›´ï¼ˆrangesï¼‰åº“ï¼Œè®©å¼€å‘è€…å¯ä»¥ç”¨æ›´åŠ ç®€æ´ã€å‡½æ•°å¼çš„æ–¹å¼å¤„ç†é›†åˆæ•°æ®ã€‚å€ŸåŠ©èŒƒå›´ï¼Œå¼€å‘è€…ä¸å†éœ€è¦æ‰‹åŠ¨ä¼ é€’ begin() å’Œ end() è¿­ä»£å™¨ï¼Œå› ä¸ºèŒƒå›´æœ¬èº«å°±çŸ¥é“è‡ªå·±çš„è¾¹ç•Œï¼Œä»è€Œæ˜¾è‘—é™ä½è¯¯ç”¨çš„é£é™©ã€‚</p>
<p>è¿™äº›ç°ä»£ C++ çš„æ”¹è¿›æªæ–½ï¼ˆå¦‚æœè¢«æ­£ç¡®ä½¿ç”¨ï¼‰ç¡®å®ä½¿ C++ æ¯” C++98 æ—¶ä»£æ›´åŠ å®‰å…¨å¯é ã€‚ç„¶è€Œï¼Œè¯­è¨€çš„å®‰å…¨æ€§ä»æœ‰å±€é™ã€‚</p>
<p>è¿˜è®°å¾—ä¹‹å‰é‚£ä¸ªè®¿é—®æœªé¢„ç•™å†…å­˜çš„ std::vector ç´¢å¼•ï¼Œæœ€ç»ˆå¯¼è‡´è¿è¡Œæ—¶å†…å­˜é”™è¯¯çš„ç¤ºä¾‹å—ï¼Ÿè®©æˆ‘ä»¬å†æ¥çœ‹ä¸€éé‚£æ®µä»£ç ï¼š</p>
<p><pre><code class="language-cpp">int doSomeWork(int value1, int value2, int value3, int value4) {
  vector&lt;int&gt; values;
  values[0] = value1;
  values[1] = value2;
  values[3] = value3;
  values[4] = value4;
  return values[0] + values[1] + values[3] + values[4];
}</code></pre></p>
<p>è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥æ¯«æ— é˜»ç¢åœ°è®¿é—®è¶…å‡º vector å·²åˆ†é…å¤§å°çš„ç´¢å¼•ï¼ŒåŒæ—¶è·³è¿‡äº†å¯¹ç´¢å¼• 2 çš„åˆå§‹åŒ–ã€‚è¿™æ­£æ˜¯æœªå®šä¹‰è¡Œä¸ºçš„å…¸å‹è¡¨ç°ã€‚</p>
<p>ä¸ºäº†è§£å†³æ­¤ç±»é—®é¢˜ï¼Œä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ï¼š</p>
<p><ul>
    <li>å¯ç”¨ç¼–è¯‘å™¨çš„å®‰å…¨æ¨¡å¼æ ‡å¿—</li>  <li>ç¼–è¯‘å™¨åœ¨æ¯æ¬¡ç´¢å¼•è®¿é—®æ—¶è‡ªåŠ¨ç”Ÿæˆè¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿æ»¡è¶³æ¡ä»¶ï¼š <code>0 <= index < collection.size()</code></li>  <li>åœ¨è¿è¡Œæ—¶æ‹¦æˆªè¶Šç•Œè®¿é—®ï¼Œä»è€Œé˜²æ­¢æœªå®šä¹‰è¡Œä¸ºçš„å‘ç”Ÿ
</ul></li></p>
<p>è¿™ç§ç¼–è¯‘é€‰é¡¹å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„å‰æä¸‹ç›´æ¥åº”ç”¨ï¼Œæœ‰æ•ˆæå‡ç¨‹åºçš„å¥å£®æ€§ï¼Œå¹¶å¸®åŠ©å‘ç°æ½œåœ¨çš„å®‰å…¨éšæ‚£ã€‚å½“ç„¶ï¼Œä¸€äº›å¼€å‘è€…å¯èƒ½ä¼šå‡ºäºå¯¹æ€§èƒ½æŸè€—çš„æ‹…å¿§è€Œåå¯¹è¿™ä¸€æœºåˆ¶ â€”â€” è¿™æ­£æ˜¯æ­¤ç±»æ£€æŸ¥åº”é€šè¿‡ç¼–è¯‘å™¨æ ‡å¿—è¿›è¡Œæ§åˆ¶çš„åŸå› ï¼šç†æƒ³æƒ…å†µä¸‹ï¼Œé»˜è®¤å¯ç”¨ï¼Œä»…åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­å…è®¸æ˜¾å¼å…³é—­ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œå°½ç®¡ç°ä»£ C++ å·²ç»åœ¨å†…å­˜å®‰å…¨æ–¹é¢å–å¾—äº†æ˜¾è‘—è¿›æ­¥ï¼Œä½†è¦çœŸæ­£å®ç°å…¨é¢çš„å®‰å…¨ä¿éšœï¼Œè¯­è¨€å’Œå·¥å…·é“¾ä»æœ‰è¿›ä¸€æ­¥æ”¹è¿›çš„ç©ºé—´ã€‚</p>
  <div class="back-to-toc" style="text-align:left"><a href="index.html">è¿”å›ç›®å½•</a></div>
<div class="navigation">
  <a href="6.4..html" class="prev-link">Â« ä¸Šä¸€ç« ï¼š6.4. ç°ä»£C++çš„æ•‘èµ</a>
  <a href="6.6..html" class="next-link">ä¸‹ä¸€ç« ï¼š6.6. ä»éœ€åŠªåŠ› Â»</a>
</div>

</div>

  </div>
  <!-- å…ˆåŠ è½½æ ¸å¿ƒåº“ -->
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  
  <!-- åŠ è½½MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>
  
  <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’®
    const themeToggle = document.createElement('button');
    themeToggle.className = 'theme-toggle';
    themeToggle.setAttribute('aria-label', 'åˆ‡æ¢ä¸»é¢˜');
    themeToggle.innerHTML = 'ğŸŒ“';
    document.body.appendChild(themeToggle);
    
    // æ·»åŠ æ·±è‰²å’Œæµ…è‰²ä¸»é¢˜çš„æ ·å¼
    const darkThemeStyle = document.createElement('style');
    const lightThemeStyle = document.createElement('style');
    
    darkThemeStyle.textContent = `
      body.dark-theme {
        --background-color: #1a1a1a;
        --text-color: #e6e6e6;
        --code-bg-color: #2d2d2d;
        --link-color: #58a6ff;
        --highlight-color: #58a6ff;
        --border-color: #333;
        --table-border-color: #444;
        --table-header-bg: #2d2d2d;
        --blockquote-color: #aaa;
        --blockquote-border: #444;
        --part-header-bg: #222;
        --footer-text-color: #aaa;
        --filename-bg: #2d2d2d;
        --nav-bg: #2d2d2d;
        --nav-hover-bg: #444;
        --toc-bg: #222;
        --highlight-section-bg: #2d2d2d;
        --highlight-section-border: #58a6ff;
      }
    `;
    
    lightThemeStyle.textContent = `
      body.light-theme {
        --background-color: #ffffff;
        --text-color: #333333;
        --code-bg-color: #f5f5f5;
        --link-color: #0366d6;
        --highlight-color: #0366d6;
        --border-color: #eee;
        --table-border-color: #ddd;
        --table-header-bg: #f2f2f2;
        --blockquote-color: #666;
        --blockquote-border: #ddd;
        --part-header-bg: #f8f8f8;
        --footer-text-color: #666;
        --filename-bg: #f5f5f5;
        --nav-bg: #f5f5f5;
        --nav-hover-bg: #e6e6e6;
        --toc-bg: #f8f8f8;
        --highlight-section-bg: #f8f8f8;
        --highlight-section-border: #0366d6;
      }
    `;
    
    document.head.appendChild(darkThemeStyle);
    document.head.appendChild(lightThemeStyle);
    
    // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è®¾ç½®
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme');
    
    if (currentTheme === 'dark') {
      document.body.classList.add('dark-theme');
    } else if (currentTheme === 'light') {
      document.body.classList.add('light-theme');
    } else {
      // å¦‚æœæ²¡æœ‰ä¿å­˜çš„åå¥½ï¼Œè·Ÿéšç³»ç»Ÿ
      if (prefersDarkScheme.matches) {
        document.body.classList.add('dark-theme');
      } else {
        document.body.classList.add('light-theme');
      }
    }
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    themeToggle.addEventListener('click', function() {
      console.log('Theme toggle clicked');
      if (document.body.classList.contains('dark-theme')) {
        document.body.classList.remove('dark-theme');
        document.body.classList.add('light-theme');
        localStorage.setItem('theme', 'light');
      } else {
        document.body.classList.remove('light-theme');
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
      }
    });
    
    // ç¡®ä¿ä»£ç å—æœ‰æ­£ç¡®çš„ç±»å
    document.querySelectorAll('pre code').forEach(function(block) {
      if (!block.className && block.parentNode.innerHTML.includes('cpp')) {
        block.className = 'language-cpp';
      } else if (!block.className && block.parentNode.innerHTML.includes('rust')) {
        block.className = 'language-rust';
      } else if (!block.className) {
        block.className = 'language-plaintext';
      }
    });
    
    // å»¶è¿ŸåŠ è½½Prismé«˜äº®
    setTimeout(function() {
      if (window.Prism) {
        window.Prism.highlightAll();
      }
    }, 500);
  });
  </script>
</body>
</html>